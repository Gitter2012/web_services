<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾·å·æ‰‘å…‹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        h1 {
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        #login-screen {
            background: rgba(255,255,255,0.1);
            padding: 40px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            text-align: center;
        }

        #login-screen input {
            padding: 12px 20px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            margin: 10px 0;
            width: 250px;
        }

        #login-screen button {
            padding: 12px 30px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            background: #4CAF50;
            color: white;
            cursor: pointer;
            margin-top: 10px;
            transition: background 0.3s;
        }

        #login-screen button:hover {
            background: #45a049;
        }

        #game-screen {
            display: none;
            width: 100%;
            max-width: 1200px;
        }

        #game-info {
            position: fixed;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            padding: 10px 25px;
            border-radius: 20px;
            display: flex;
            gap: 30px;
            align-items: center;
            z-index: 500;
            border: 2px solid rgba(255,215,0,0.3);
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-label {
            font-size: 13px;
            opacity: 0.8;
        }

        .info-value {
            font-size: 20px;
            font-weight: bold;
            color: #FFD700;
        }

        #poker-table {
            background: radial-gradient(ellipse at center, #0d7d0d 0%, #0a5f0a 100%);
            border: 15px solid #8B4513;
            border-radius: 50%;
            width: 1000px;
            height: 600px;
            margin: 80px auto 120px;
            position: relative;
            box-shadow: 0 10px 50px rgba(0,0,0,0.5), inset 0 0 50px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #community-cards {
            display: flex;
            justify-content: center;
            gap: 10px;
            position: absolute;
            top: 45%;
            left: 50%;
            transform: translate(-50%, -50%);
            min-height: 140px;
            align-items: center;
            z-index: 10;
        }

        .card {
            width: 80px;
            height: 120px;
            background: white;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            color: #000;
        }

        .card.hearts, .card.diamonds {
            color: #d32f2f;
        }

        .card.clubs, .card.spades {
            color: #000;
        }

        .card-back {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        #players-area {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }

        .player-card {
            background: rgba(255,255,255,0.15);
            padding: 12px;
            border-radius: 15px;
            backdrop-filter: blur(5px);
            border: 3px solid rgba(255,255,255,0.3);
            transition: all 0.3s;
            position: absolute;
            width: 160px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }
        
        /* ç©å®¶å¤´åƒ */
        .player-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin: 0 auto 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: white;
            border: 3px solid rgba(255,255,255,0.5);
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            position: relative;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .player-avatar.ai::after {
            content: 'ğŸ¤–';
            position: absolute;
            bottom: -3px;
            right: -3px;
            font-size: 16px;
            background: rgba(0,0,0,0.8);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid white;
        }
        
        /* åº§ä½ä½ç½®ç”±JavaScriptåŠ¨æ€è®¡ç®— */

        .player-card.current-turn {
            border-color: #FFD700;
            box-shadow: 0 0 30px rgba(255,215,0,0.8);
            background: rgba(255,215,0,0.2);
            transform: scale(1.05);
        }
        
        /* è¡ŒåŠ¨å€’è®¡æ—¶ */
        .turn-timer {
            position: absolute;
            bottom: -25px;
            left: 0;
            right: 0;
            height: 20px;
            background: rgba(0,0,0,0.7);
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        .turn-timer-bar {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #FFC107, #f44336);
            transition: width 0.3s linear;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: bold;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.8);
        }
        
        .turn-timer-bar.warning {
            animation: timerWarning 0.5s ease-in-out infinite;
        }
        
        @keyframes timerWarning {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .player-card.current-user {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.15);
        }
        
        .player-card.current-user.current-turn {
            border-color: #FFD700;
            box-shadow: 0 0 30px rgba(255,215,0,0.8), 0 0 15px rgba(76, 175, 80, 0.5);
            background: rgba(255,215,0,0.25);
        }

        .player-card.folded {
            opacity: 0.5;
        }

        .player-card.dealer::before {
            content: "ğŸ¯ D";
            position: absolute;
            top: -12px;
            right: -12px;
            background: #FFD700;
            color: #000;
            padding: 8px;
            border-radius: 50%;
            font-size: 14px;
            font-weight: bold;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        .player-name {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 5px;
            text-align: center;
        }

        .player-chips {
            font-size: 12px;
            color: #FFD700;
            margin: 3px 0;
            text-align: center;
        }

        .player-bet {
            font-size: 11px;
            color: #4CAF50;
            margin: 3px 0;
            text-align: center;
        }

        .player-status {
            font-size: 11px;
            opacity: 0.8;
            margin: 3px 0;
            text-align: center;
            font-weight: bold;
            color: #ff6b6b;
        }

        .player-stats {
            font-size: 10px;
            opacity: 0.7;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(255,255,255,0.2);
        }

        .player-stats-item {
            display: flex;
            justify-content: space-between;
            margin: 3px 0;
        }

        .stat-positive {
            color: #4CAF50;
        }

        .stat-negative {
            color: #f44336;
        }

        .player-hand {
            display: flex;
            gap: 5px;
            margin-top: 8px;
            justify-content: center;
        }

        .player-hand .card {
            width: 45px;
            height: 65px;
            font-size: 14px;
        }

        /* å·¦ä¸Šè§’å·¥å…·æŒ‰é’®ç»„ */
        #utility-buttons {
            position: fixed;
            top: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 500;
        }
        
        #utility-buttons button {
            padding: 10px 15px;
            font-size: 14px;
            min-width: 140px;
            text-align: left;
            background: rgba(0,0,0,0.85);
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        /* å³ä¸‹è§’åŠ¨ä½œæŒ‰é’®ç»„ */
        #action-buttons {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.85);
            padding: 15px;
            border-radius: 15px;
            z-index: 500;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            border: 2px solid rgba(255,255,255,0.3);
            display: none;
            flex-direction: column;
            gap: 10px;
            min-width: 180px;
        }
        
        #action-buttons.show {
            display: flex;
        }

        button {
            padding: 10px 20px;
            font-size: 14px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-start {
            background: #4CAF50;
            color: white;
        }

        .btn-start:hover:not(:disabled) {
            background: #45a049;
        }

        .btn-fold {
            background: #f44336;
            color: white;
        }

        .btn-fold:hover:not(:disabled) {
            background: #da190b;
        }

        .btn-check {
            background: #2196F3;
            color: white;
        }

        .btn-check:hover:not(:disabled) {
            background: #0b7dda;
        }

        .btn-call {
            background: #FF9800;
            color: white;
        }

        .btn-call:hover:not(:disabled) {
            background: #e68900;
        }

        .btn-raise {
            background: #9C27B0;
            color: white;
        }

        .btn-raise:hover:not(:disabled) {
            background: #7b1fa2;
        }
        
        /* å¿«æ·åŠ æ³¨æŒ‰é’® */
        .quick-raise-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
            margin: 5px 0;
        }
        
        .btn-quick-raise {
            padding: 8px 5px;
            font-size: 12px;
            border: 2px solid #607D8B;
            border-radius: 6px;
            background: rgba(96, 125, 139, 0.2);
            color: #fff;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
        }
        
        .btn-quick-raise:hover {
            background: #607D8B;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        
        .btn-quick-raise.btn-allin {
            border-color: #f44336;
            color: #f44336;
            background: rgba(244, 67, 54, 0.2);
        }
        
        .btn-quick-raise.btn-allin:hover {
            background: #f44336;
            color: white;
        }

        #raise-amount {
            padding: 10px;
            font-size: 16px;
            border: 2px solid #9C27B0;
            border-radius: 8px;
            width: 120px;
            margin: 0 10px;
        }
        
        /* åº•æ± æ˜¾ç¤º */
        .pot-display {
            position: absolute;
            top: 15%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.85);
            padding: 12px 25px;
            border-radius: 30px;
            border: 3px solid #FFD700;
            font-size: 20px;
            font-weight: bold;
            color: #FFD700;
            box-shadow: 0 4px 20px rgba(255,215,0,0.5);
            z-index: 15;
        }

        #messages {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.9);
            padding: 10px 15px;
            border-radius: 10px;
            max-height: 200px;
            max-width: 350px;
            min-width: 250px;
            overflow-y: auto;
            z-index: 400;
            border: 1px solid rgba(255,255,255,0.3);
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        .message {
            padding: 6px 10px;
            margin: 3px 0;
            border-radius: 5px;
            background: rgba(255,255,255,0.1);
            font-size: 13px;
        }

        .message.error {
            background: rgba(244, 67, 54, 0.3);
        }

        .message.success {
            background: rgba(76, 175, 80, 0.3);
        }

        #game-result {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            padding: 30px;
            border-radius: 15px;
            display: none;
            border: 3px solid #FFD700;
            z-index: 600;
            max-width: 500px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.8);
        }

        #game-result.show {
            display: block;
        }

        .result-title {
            font-size: 28px;
            font-weight: bold;
            text-align: center;
            color: #FFD700;
            margin-bottom: 20px;
        }

        .winner-info {
            text-align: center;
            font-size: 20px;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255,215,0,0.2);
            border-radius: 10px;
        }

        .player-result {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .player-result.winner {
            background: rgba(76,175,80,0.3);
            border: 2px solid #4CAF50;
        }

        /* è‡ªåŠ¨å¼€å§‹å€’è®¡æ—¶ */
        #auto-start-info {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            background: rgba(255,165,0,0.3);
            border-radius: 10px;
            border: 2px solid #FFA500;
        }

        #countdown {
            font-size: 32px;
            font-weight: bold;
            color: #FFD700;
            margin: 10px 0;
        }

        #cancel-auto-start {
            padding: 10px 20px;
            font-size: 16px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        #cancel-auto-start:hover {
            background: #da190b;
        }

        .player-result-name {
            font-size: 18px;
            font-weight: bold;
        }

        .player-result-hand {
            display: flex;
            gap: 5px;
            margin: 5px 0;
        }
        
        /* ä¾§è¾¹æ é¢æ¿ */
        .sidebar-panel {
            position: fixed;
            top: 20px;
            width: 320px;
            max-height: calc(100vh - 40px);
            background: rgba(0,0,0,0.9);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.2);
            overflow-y: auto;
            z-index: 1000;
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }
        
        #history-panel {
            left: 20px;
            display: block !important;
            opacity: 1;
        }
        
        #history-panel.hidden {
            transform: translateX(-100%);
            opacity: 0;
            pointer-events: none;
        }
        
        #leaderboard-panel {
            right: 20px;
            display: block !important;
            opacity: 1;
        }
        
        #leaderboard-panel.hidden {
            transform: translateX(100%);
            opacity: 0;
            pointer-events: none;
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255,255,255,0.2);
        }
        
        .panel-header h2 {
            margin: 0;
            font-size: 20px;
        }
        
        .panel-toggle-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s;
        }
        
        .panel-toggle-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .sidebar-panel::-webkit-scrollbar {
            width: 8px;
        }
        
        .sidebar-panel::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }
        
        .sidebar-panel::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
        }
        
        .sidebar-panel::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.5);
        }
        
        /* è®¾ç½®é¢æ¿ */
        #settings-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 450px;
            max-height: 80vh;
            background: rgba(0,0,0,0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.8);
            border: 3px solid rgba(255,255,255,0.3);
            z-index: 1500;
            overflow-y: auto;
            display: none;
        }
        
        #settings-panel.show {
            display: block;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255,255,255,0.2);
        }
        
        .settings-header h2 {
            margin: 0;
            font-size: 28px;
            color: #FFD700;
        }
        
        .settings-close-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .settings-close-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: rotate(90deg);
        }
        
        .setting-group {
            margin-bottom: 25px;
        }
        
        .setting-label {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #FFD700;
            display: block;
        }
        
        .setting-description {
            font-size: 13px;
            color: rgba(255,255,255,0.6);
            margin-bottom: 10px;
        }
        
        .setting-control {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        /* å¼€å…³æŒ‰é’® */
        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: rgba(255,255,255,0.2);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .toggle-switch.active {
            background: #4CAF50;
        }
        
        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background: white;
            top: 2px;
            left: 2px;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        
        .toggle-switch.active::after {
            left: 32px;
        }
        
        /* æ»‘å— */
        .slider-control {
            flex: 1;
        }
        
        .slider-control input[type="range"] {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }
        
        .slider-control input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #FFD700;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        
        .slider-control input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #FFD700;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        
        .slider-value {
            min-width: 45px;
            text-align: center;
            font-weight: bold;
            color: #FFD700;
            font-size: 16px;
        }
        
        .setting-icon {
            font-size: 24px;
            min-width: 30px;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .player-result-hand .card {
            width: 50px;
            height: 75px;
            font-size: 16px;
        }

        .player-result-type {
            font-size: 16px;
            color: #FFD700;
        }

        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes dealCard {
            from {
                transform: translateY(-100px) scale(0.5);
                opacity: 0;
            }
            to {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        @keyframes flipCard {
            0% {
                transform: rotateY(0deg);
            }
            50% {
                transform: rotateY(90deg);
            }
            100% {
                transform: rotateY(0deg);
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        @keyframes slideIn {
            from {
                transform: translateX(-50px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes chipMove {
            0% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-20px);
            }
            100% {
                transform: translateY(0);
            }
        }

        @keyframes glow {
            0%, 100% {
                box-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
            }
            50% {
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
            }
        }

        @keyframes winPulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 0 30px rgba(255, 215, 0, 1);
            }
        }

        @keyframes bounceIn {
            0% {
                transform: scale(0.3);
                opacity: 0;
            }
            50% {
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .card.deal-animation {
            animation: dealCard 0.5s ease-out;
        }

        .card.flip-animation {
            animation: flipCard 0.6s ease-in-out;
        }

        .player-card.current-turn {
            animation: glow 2s ease-in-out infinite;
        }

        .player-result.winner {
            animation: winPulse 1.5s ease-in-out infinite;
        }

        .info-value.update-animation, .pot-display.update-animation {
            animation: pulse 0.5s ease-in-out;
        }

        #game-result {
            animation: slideIn 0.5s ease-out;
        }

        #game-result.show .result-title {
            animation: bounceIn 0.8s ease-out;
        }

        .player-card.folded {
            animation: shake 0.5s ease-in-out;
        }

        /* åŠ¨ä½œæç¤ºæµ®åŠ¨æ•ˆæœ */
        @keyframes floatUp {
            0% {
                transform: translateY(0);
                opacity: 1;
            }
            100% {
                transform: translateY(-50px);
                opacity: 0;
            }
        }

        .action-indicator {
            position: fixed;
            font-size: 24px;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            pointer-events: none;
            z-index: 1000;
            animation: floatUp 1s ease-out forwards;
        }

        /* ç­¹ç ç§»åŠ¨åŠ¨ç”» */
        @keyframes chipsToPot {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            50% {
                transform: translate(var(--tx), var(--ty)) scale(1.2);
                opacity: 0.8;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) scale(0.5);
                opacity: 0;
            }
        }

        .chips-animation {
            position: fixed;
            font-size: 32px;
            pointer-events: none;
            z-index: 999;
            animation: chipsToPot 0.8s ease-out forwards;
        }

        @media (max-width: 768px) {
            #poker-table {
                padding: 30px;
            }

            .card {
                width: 60px;
                height: 90px;
                font-size: 18px;
            }

            #players-area {
                grid-template-columns: 1fr;
            }
            
            /* ç§»åŠ¨ç«¯æ¶ˆæ¯é€šçŸ¥ä¼˜åŒ– */
            #messages {
                top: 10px;
                right: 10px;
                left: 10px;
                max-width: calc(100% - 20px);
                min-width: auto;
                max-height: 150px;
                font-size: 12px;
                padding: 8px 10px;
            }
            
            .message {
                font-size: 12px;
                padding: 5px 8px;
            }
            
            /* ç§»åŠ¨ç«¯è®¾ç½®é¢æ¿ä¼˜åŒ– */
            #settings-panel {
                width: 90%;
                max-width: 400px;
                max-height: 90vh;
                padding: 20px;
                border-radius: 15px;
            }
            
            .settings-header h2 {
                font-size: 20px;
            }
            
            .settings-close-btn {
                width: 35px;
                height: 35px;
                font-size: 20px;
            }
            
            .setting-group {
                padding: 12px;
                margin-bottom: 12px;
            }
            
            .setting-label {
                font-size: 14px;
            }
            
            .setting-description {
                font-size: 11px;
            }
            
            .setting-control {
                font-size: 13px;
            }
            
            .toggle-switch {
                width: 50px;
                height: 25px;
            }
            
            .toggle-switch::after {
                width: 19px;
                height: 19px;
            }
            
            .toggle-switch.active::after {
                transform: translateX(25px);
            }
            
            .theme-btn {
                padding: 8px 12px;
                font-size: 12px;
            }
            
            /* ç§»åŠ¨ç«¯å·¦ä¸Šè§’å·¥å…·æŒ‰é’® */
            #utility-buttons {
                top: 10px;
                left: 10px;
                gap: 8px;
            }
            
            #utility-buttons button {
                font-size: 12px;
                padding: 8px 12px;
                min-width: 120px;
            }
            
            /* ç§»åŠ¨ç«¯å³ä¸‹è§’åŠ¨ä½œæŒ‰é’® */
            #action-buttons {
                bottom: 10px;
                right: 10px;
                padding: 10px;
                min-width: 150px;
            }
            
            #action-buttons button {
                font-size: 13px;
                padding: 8px 12px;
            }
            
            #action-buttons input {
                font-size: 12px;
                padding: 6px;
            }
            
            /* ç§»åŠ¨ç«¯å¿«æ·åŠ æ³¨æŒ‰é’® */
            .quick-raise-buttons {
                gap: 3px;
            }
            
            .btn-quick-raise {
                font-size: 11px;
                padding: 6px 3px;
            }
            
            .btn-start, .btn-action {
                font-size: 13px;
                padding: 8px 15px;
                margin: 2px;
            }
        }
        
        /* ç¦ç”¨åŠ¨ç”» */
        body.no-animation * {
            animation: none !important;
            transition: none !important;
        }
    </style>
</head>
<body>
    <h1>ğŸ² å¾·å·æ‰‘å…‹ ğŸ²</h1>

    <div id="login-screen">
        <h2>æ¬¢è¿æ¥åˆ°å¾·å·æ‰‘å…‹</h2>
        <p style="margin: 20px 0;">è¯·è¾“å…¥æ‚¨çš„æ˜µç§°åŠ å…¥æ¸¸æˆ</p>
        <input type="text" id="player-name-input" placeholder="è¾“å…¥æ˜µç§°" maxlength="20">
        <br>
        <button onclick="joinGame()">åŠ å…¥æ¸¸æˆ</button>
    </div>

    <div id="game-screen">
        <div id="game-info">
            <div class="info-item">
                <div class="info-label">æ¸¸æˆé˜¶æ®µ</div>
                <div class="info-value" id="game-stage">ç­‰å¾…ä¸­</div>
            </div>
            <div class="info-item">
                <div class="info-label">åº•æ± </div>
                <div class="info-value" id="pot-amount">0</div>
            </div>
            <div class="info-item">
                <div class="info-label">å½“å‰ä¸‹æ³¨</div>
                <div class="info-value" id="current-bet">0</div>
            </div>
        </div>

        <div id="poker-table">
            <div class="pot-display" id="pot-display">ğŸ’° åº•æ± : 0</div>
            <div id="community-cards"></div>
            <div id="players-area"></div>
        </div>
        
        <!-- å·¦ä¸Šè§’å·¥å…·æŒ‰é’®ç»„ -->
        <div id="utility-buttons">
            <button id="start-btn" class="btn-start" onclick="startGame()">ğŸ® å¼€å§‹æ¸¸æˆ</button>
            <button id="add-ai-btn" class="btn-start" onclick="addAIPlayer()" style="background: #FF9800;">ğŸ¤– æ·»åŠ AIç©å®¶</button>
            <button id="history-btn" class="btn-start" onclick="toggleHistory()" style="background: #2196F3;">ğŸ“œ ç‰Œå±€å›é¡¾</button>
            <button id="leaderboard-btn" class="btn-start" onclick="toggleLeaderboard()" style="background: #9C27B0;">ğŸ† æ’è¡Œæ¦œ</button>
            <button id="settings-btn" class="btn-start" onclick="toggleSettings()" style="background: #607D8B;">âš™ï¸ è®¾ç½®</button>
            <button id="end-game-btn" class="btn-start" onclick="endGame()" style="background: #f44336; display: none;">ğŸ ç»“æŸæ¸¸æˆ</button>
        </div>
        
        <!-- å³ä¸‹è§’åŠ¨ä½œæŒ‰é’®ç»„ -->
        <div id="action-buttons">
            <button class="btn-fold" onclick="playerAction('fold')">å¼ƒç‰Œ</button>
            <button class="btn-check" onclick="playerAction('check')">è¿‡ç‰Œ</button>
            <button class="btn-call" onclick="playerAction('call')">è·Ÿæ³¨</button>
            
            <!-- å¿«æ·åŠ æ³¨æŒ‰é’® -->
            <div class="quick-raise-buttons">
                <button class="btn-quick-raise" onclick="quickRaise('min')" title="æœ€å°åŠ æ³¨">æœ€å°</button>
                <button class="btn-quick-raise" onclick="quickRaise('half')" title="åŠä¸ªåº•æ± ">åŠæ± </button>
                <button class="btn-quick-raise" onclick="quickRaise('pot')" title="å…¨éƒ¨åº•æ± ">å…¨æ± </button>
                <button class="btn-quick-raise btn-allin" onclick="quickRaise('allin')" title="All In">All-In</button>
            </div>
            
            <div style="display: flex; gap: 5px;">
                <input type="number" id="raise-amount" placeholder="åŠ æ³¨é‡‘é¢" min="0" style="flex: 1;">
                <button class="btn-raise" onclick="playerAction('raise')">åŠ æ³¨</button>
            </div>
        </div>

        <div id="game-result"></div>

        <div id="messages"></div>
        
        <!-- å†å²è®°å½•é¢æ¿ - å·¦ä¾§è¾¹æ  -->
        <div id="history-panel" class="sidebar-panel hidden">
            <div class="panel-header">
                <h2>ğŸ“œ ç‰Œå±€å›é¡¾</h2>
                <button class="panel-toggle-btn" onclick="toggleHistory()">â—€</button>
            </div>
            <div id="history-content">
                <p style="text-align: center; opacity: 0.7;">åŠ è½½ä¸­...</p>
            </div>
        </div>
        
        <!-- æ’è¡Œæ¦œé¢æ¿ - å³ä¾§è¾¹æ  -->
        <div id="leaderboard-panel" class="sidebar-panel hidden">
            <div class="panel-header">
                <h2>ğŸ† å®æ—¶æ’è¡Œæ¦œ</h2>
                <button class="panel-toggle-btn" onclick="toggleLeaderboard()">â–¶</button>
            </div>
            <div id="leaderboard-content">
                <p style="text-align: center; opacity: 0.7;">åŠ è½½ä¸­...</p>
            </div>
        </div>
        
        <!-- æœ€ç»ˆç»“æœé¢æ¿ -->
        <div id="final-results-panel" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 700; max-width: 800px; max-height: 90vh; overflow-y: auto;">
            <div style="background: rgba(0,0,0,0.95); padding: 30px; border-radius: 15px; border: 3px solid #FFD700; box-shadow: 0 10px 50px rgba(0,0,0,0.8);">
                <div style="text-align: center; margin-bottom: 30px;">
                    <h1 style="margin: 0; font-size: 36px;">ğŸ† æ¸¸æˆç»“æŸ ğŸ†</h1>
                    <p style="margin-top: 10px; font-size: 18px; opacity: 0.8;">æœ€ç»ˆæ’å</p>
                </div>
                <div id="final-results-content">
                </div>
                <div style="text-align: center; margin-top: 30px;">
                    <button onclick="location.reload()" class="btn-start" style="font-size: 18px; padding: 15px 30px;">
                        ğŸ”„ é‡æ–°å¼€å§‹
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- è®¾ç½®é¢æ¿ -->
    <div id="settings-panel">
        <div class="settings-header">
            <h2>âš™ï¸ æ¸¸æˆè®¾ç½®</h2>
            <button class="settings-close-btn" onclick="toggleSettings()">âœ•</button>
        </div>
        
        <div class="setting-group">
            <label class="setting-label">
                <span class="setting-icon">ğŸ”Š</span> éŸ³æ•ˆæ§åˆ¶
            </label>
            <div class="setting-description">æ§åˆ¶æ¸¸æˆéŸ³æ•ˆçš„å¼€å…³å’ŒéŸ³é‡</div>
            <div class="setting-control">
                <span>éŸ³æ•ˆå¼€å…³</span>
                <div class="toggle-switch active" id="sound-toggle" onclick="toggleSound()"></div>
            </div>
        </div>
        
        <div class="setting-group">
            <label class="setting-label">
                <span class="setting-icon">ğŸ”‰</span> éŸ³é‡è°ƒèŠ‚
            </label>
            <div class="setting-control">
                <span class="setting-icon">ğŸ”‡</span>
                <div class="slider-control">
                    <input type="range" id="volume-slider" min="0" max="100" value="100" oninput="updateVolume(this.value)">
                </div>
                <span class="slider-value" id="volume-value">100%</span>
            </div>
        </div>
        
        <div class="setting-group">
            <label class="setting-label">
                <span class="setting-icon">âœ¨</span> åŠ¨ç”»æ•ˆæœ
            </label>
            <div class="setting-description">æ§åˆ¶æ¸¸æˆä¸­çš„åŠ¨ç”»æ•ˆæœ</div>
            <div class="setting-control">
                <span>åŠ¨ç”»å¼€å…³</span>
                <div class="toggle-switch active" id="animation-toggle" onclick="toggleAnimation()"></div>
            </div>
        </div>
        
        <div class="setting-group">
            <label class="setting-label">
                <span class="setting-icon">â±ï¸</span> è‡ªåŠ¨å¼€å§‹
            </label>
            <div class="setting-description">æ¯å±€ç»“æŸåè‡ªåŠ¨å¼€å§‹ä¸‹ä¸€å±€çš„å€’è®¡æ—¶</div>
            <div class="setting-control">
                <span>è‡ªåŠ¨å¼€å§‹</span>
                <div class="toggle-switch active" id="autostart-toggle" onclick="toggleAutoStart()"></div>
            </div>
        </div>
        
        <div class="setting-group">
            <label class="setting-label">
                <span class="setting-icon">â°</span> è¡ŒåŠ¨è¶…æ—¶
            </label>
            <div class="setting-description">æ¯è½®è¡ŒåŠ¨çš„æ—¶é—´é™åˆ¶ï¼Œè¶…æ—¶å°†è‡ªåŠ¨å¼ƒç‰Œ</div>
            <div class="setting-control">
                <span>è¶…æ—¶æ—¶é—´</span>
                <span id="timeout-value" style="color: #FFD700; font-weight: bold;">30ç§’</span>
            </div>
            <input type="range" id="timeout-slider" min="10" max="120" step="5" value="30" 
                   oninput="updateTimeout(this.value)" 
                   style="width: 100%; margin-top: 10px;">
            <div style="display: flex; justify-content: space-between; font-size: 11px; opacity: 0.7; margin-top: 5px;">
                <span>10ç§’</span>
                <span>60ç§’</span>
                <span>120ç§’</span>
            </div>
        </div>
        
        <div class="setting-group">
            <label class="setting-label">
                <span class="setting-icon">ğŸ¨</span> æ¸¸æˆä¸»é¢˜
            </label>
            <div class="setting-description">é€‰æ‹©æ¸¸æˆçš„é¢œè‰²ä¸»é¢˜</div>
            <div class="setting-control" style="flex-wrap: wrap;">
                <button class="btn-start" onclick="setTheme('default')" style="background: #1e3c72; flex: 1; min-width: 100px;">ç»å…¸è“</button>
                <button class="btn-start" onclick="setTheme('green')" style="background: #0a5f0a; flex: 1; min-width: 100px;">æ‰‘å…‹ç»¿</button>
                <button class="btn-start" onclick="setTheme('dark')" style="background: #1a1a1a; flex: 1; min-width: 100px;">æš—é»‘</button>
            </div>
        </div>
        
        <div class="setting-group" style="border-top: 2px solid rgba(255,255,255,0.1); padding-top: 20px; margin-top: 20px;">
            <div style="text-align: center; opacity: 0.7; font-size: 13px;">
                <p>å¾·å·æ‰‘å…‹ v1.0</p>
                <p>æ‰€æœ‰è®¾ç½®å°†è‡ªåŠ¨ä¿å­˜åˆ°æœ¬åœ°</p>
            </div>
        </div>
    </div>

    <script>
        let ws = null;
        let playerId = null;
        let currentGameState = null;
        let autoStartTimer = null;
        let autoStartCountdown = null;
        let turnTimer = null; // è¡ŒåŠ¨è®¡æ—¶å™¨
        let turnTimeRemaining = 0; // å‰©ä½™æ—¶é—´

        function getBasePath() {
            const path = window.location.pathname || '';
            if (path === '/' || path === '') {
                return '';
            }

            let base = path;
            if (base.endsWith('/')) {
                base = base.slice(0, -1);
            }
            if (base.endsWith('.html')) {
                base = base.slice(0, base.lastIndexOf('/'));
            }

            return base;
        }

        const basePath = getBasePath();
        
        // æ¸¸æˆè®¾ç½®ï¼ˆä»localStorageåŠ è½½ï¼‰
        const gameSettings = {
            soundEnabled: localStorage.getItem('soundEnabled') !== 'false',
            volume: parseInt(localStorage.getItem('volume') || '100'),
            animationEnabled: localStorage.getItem('animationEnabled') !== 'false',
            autoStartEnabled: localStorage.getItem('autoStartEnabled') !== 'false',
            theme: localStorage.getItem('theme') || 'default',
            turnTimeout: parseInt(localStorage.getItem('turnTimeout') || '30') // è¡ŒåŠ¨è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
        };

        // éŸ³æ•ˆç³»ç»Ÿ
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioContext = new AudioContext();
        
        // ä¸»éŸ³é‡æ§åˆ¶
        const masterGain = audioContext.createGain();
        masterGain.connect(audioContext.destination);
        masterGain.gain.value = gameSettings.volume / 100;

        const soundEffects = {
            // æ’­æ”¾éŸ³æ•ˆçš„åŒ…è£…å‡½æ•°
            play: (soundFunc) => {
                if (!gameSettings.soundEnabled) return;
                soundFunc();
            },
            
            // å‘ç‰ŒéŸ³æ•ˆ
            dealCard: () => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(masterGain);
                
                oscillator.frequency.value = 400;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            },
            
            // ä¸‹æ³¨éŸ³æ•ˆ
            bet: () => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(masterGain);
                
                oscillator.frequency.value = 300;
                oscillator.type = 'square';
                
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.15);
            },
            
            // è·èƒœéŸ³æ•ˆ
            win: () => {
                const notes = [523.25, 659.25, 783.99]; // C, E, G
                notes.forEach((freq, index) => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(masterGain);
                    
                    oscillator.frequency.value = freq;
                    oscillator.type = 'sine';
                    
                    const startTime = audioContext.currentTime + index * 0.1;
                    gainNode.gain.setValueAtTime(0.3, startTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + 0.3);
                    
                    oscillator.start(startTime);
                    oscillator.stop(startTime + 0.3);
                });
            },
            
            // å¼ƒç‰ŒéŸ³æ•ˆ
            fold: () => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(masterGain);
                
                oscillator.frequency.value = 200;
                oscillator.type = 'sawtooth';
                
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.2);
            },
            
            // ç¿»ç‰ŒéŸ³æ•ˆ
            flip: () => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(masterGain);
                
                oscillator.frequency.value = 600;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.25, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.2);
            },
            
            // é€šçŸ¥éŸ³æ•ˆ
            notify: () => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(masterGain);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            }
        };

        function addMessage(text, type = 'info') {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = text;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            
            // é™åˆ¶æ¶ˆæ¯æ•°é‡
            while (messagesDiv.children.length > 10) {
                messagesDiv.removeChild(messagesDiv.firstChild);
            }
        }

        // æ˜¾ç¤ºåŠ¨ä½œæŒ‡ç¤ºå™¨
        function showActionIndicator(text, x, y) {
            const indicator = document.createElement('div');
            indicator.className = 'action-indicator';
            indicator.textContent = text;
            indicator.style.left = x + 'px';
            indicator.style.top = y + 'px';
            document.body.appendChild(indicator);
            
            setTimeout(() => {
                indicator.remove();
            }, 1000);
        }

        // æ˜¾ç¤ºç­¹ç é£å‘åº•æ± çš„åŠ¨ç”»
        function showChipsAnimation(fromX, fromY, toX, toY, amount) {
            const chips = document.createElement('div');
            chips.className = 'chips-animation';
            chips.textContent = 'ğŸ’° +' + amount;
            chips.style.left = fromX + 'px';
            chips.style.top = fromY + 'px';
            chips.style.setProperty('--tx', (toX - fromX) + 'px');
            chips.style.setProperty('--ty', (toY - fromY) + 'px');
            document.body.appendChild(chips);
            
            setTimeout(() => {
                chips.remove();
            }, 800);
        }
        
        // è®¾ç½®åŠŸèƒ½
        function toggleSettings() {
            const panel = document.getElementById('settings-panel');
            panel.classList.toggle('show');
            
            // åŒæ­¥UIçŠ¶æ€
            if (panel.classList.contains('show')) {
                updateSettingsUI();
            }
        }
        
        function updateSettingsUI() {
            // æ›´æ–°éŸ³æ•ˆå¼€å…³
            const soundToggle = document.getElementById('sound-toggle');
            if (gameSettings.soundEnabled) {
                soundToggle.classList.add('active');
            } else {
                soundToggle.classList.remove('active');
            }
            
            // æ›´æ–°éŸ³é‡
            document.getElementById('volume-slider').value = gameSettings.volume;
            document.getElementById('volume-value').textContent = gameSettings.volume + '%';
            
            // æ›´æ–°åŠ¨ç”»å¼€å…³
            const animToggle = document.getElementById('animation-toggle');
            if (gameSettings.animationEnabled) {
                animToggle.classList.add('active');
            } else {
                animToggle.classList.remove('active');
            }
            
            // æ›´æ–°è‡ªåŠ¨å¼€å§‹å¼€å…³
            const autoToggle = document.getElementById('autostart-toggle');
            if (gameSettings.autoStartEnabled) {
                autoToggle.classList.add('active');
            } else {
                autoToggle.classList.remove('active');
            }
            
            // æ›´æ–°è¶…æ—¶æ—¶é—´
            document.getElementById('timeout-slider').value = gameSettings.turnTimeout;
            document.getElementById('timeout-value').textContent = gameSettings.turnTimeout + 'ç§’';
        }
        
        function updateTimeout(value) {
            gameSettings.turnTimeout = parseInt(value);
            localStorage.setItem('turnTimeout', gameSettings.turnTimeout);
            document.getElementById('timeout-value').textContent = value + 'ç§’';
        }
        
        function toggleSound() {
            gameSettings.soundEnabled = !gameSettings.soundEnabled;
            localStorage.setItem('soundEnabled', gameSettings.soundEnabled);
            
            const toggle = document.getElementById('sound-toggle');
            toggle.classList.toggle('active');
            
            // æ’­æ”¾æµ‹è¯•éŸ³æ•ˆ
            if (gameSettings.soundEnabled) {
                soundEffects.play(() => soundEffects.notify());
            }
        }
        
        function updateVolume(value) {
            gameSettings.volume = parseInt(value);
            localStorage.setItem('volume', gameSettings.volume);
            
            // æ›´æ–°ä¸»éŸ³é‡
            masterGain.gain.value = gameSettings.volume / 100;
            
            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('volume-value').textContent = value + '%';
            
            // æ’­æ”¾æµ‹è¯•éŸ³æ•ˆ
            if (gameSettings.soundEnabled) {
                soundEffects.play(() => soundEffects.dealCard());
            }
        }
        
        function toggleAnimation() {
            gameSettings.animationEnabled = !gameSettings.animationEnabled;
            localStorage.setItem('animationEnabled', gameSettings.animationEnabled);
            
            const toggle = document.getElementById('animation-toggle');
            toggle.classList.toggle('active');
            
            // æ›´æ–°bodyçš„class
            if (gameSettings.animationEnabled) {
                document.body.classList.remove('no-animation');
            } else {
                document.body.classList.add('no-animation');
            }
        }
        
        function toggleAutoStart() {
            gameSettings.autoStartEnabled = !gameSettings.autoStartEnabled;
            localStorage.setItem('autoStartEnabled', gameSettings.autoStartEnabled);
            
            const toggle = document.getElementById('autostart-toggle');
            toggle.classList.toggle('active');
        }
        
        function setTheme(theme) {
            gameSettings.theme = theme;
            localStorage.setItem('theme', theme);
            
            // åº”ç”¨ä¸»é¢˜
            const body = document.body;
            body.className = ''; // æ¸…é™¤æ‰€æœ‰class
            if (theme !== 'default') {
                body.classList.add('theme-' + theme);
            }
            
            // é‡æ–°åŠ è½½é¡µé¢ä»¥åº”ç”¨ä¸»é¢˜ï¼ˆæˆ–è€…åŠ¨æ€ä¿®æ”¹CSSå˜é‡ï¼‰
            location.reload();
        }
        
        // é¡µé¢åŠ è½½æ—¶åº”ç”¨è®¾ç½®
        window.addEventListener('DOMContentLoaded', () => {
            // åº”ç”¨ä¿å­˜çš„è®¾ç½®
            if (!gameSettings.animationEnabled) {
                document.body.classList.add('no-animation');
            }
            
            if (gameSettings.theme !== 'default') {
                document.body.classList.add('theme-' + gameSettings.theme);
            }
        });

        function joinGame() {
            const playerName = document.getElementById('player-name-input').value.trim();
            if (!playerName) {
                alert('è¯·è¾“å…¥æ˜µç§°');
                return;
            }

            // è¿æ¥WebSocket
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            ws = new WebSocket(`${protocol}//${window.location.host}${basePath}/ws/${encodeURIComponent(playerName)}`);

            ws.onopen = () => {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('game-screen').style.display = 'block';
                addMessage(`${playerName} åŠ å…¥äº†æ¸¸æˆ`, 'success');
            };

            ws.onmessage = (event) => {
                const message = JSON.parse(event.data);
                handleMessage(message);
            };

            ws.onerror = (error) => {
                addMessage('è¿æ¥é”™è¯¯', 'error');
                console.error('WebSocket error:', error);
            };

            ws.onclose = () => {
                addMessage('è¿æ¥å·²æ–­å¼€', 'error');
                stopTurnTimer();
                stopAITimer();
            };
        }

        function handleMessage(message) {
            const { type, data } = message;

            switch (type) {
                case 'player_id':
                    playerId = data.player_id;
                    // è¿æ¥åé»˜è®¤æ˜¾ç¤ºæ’è¡Œæ¦œ
                    setTimeout(() => {
                        const leaderboardPanel = document.getElementById('leaderboard-panel');
                        if (leaderboardPanel.classList.contains('hidden')) {
                            toggleLeaderboard();
                        }
                    }, 1000);
                    break;

                case 'player_joined':
                    addMessage(`${data.player_name} åŠ å…¥äº†æ¸¸æˆ`, 'success');
                    soundEffects.play(() => soundEffects.notify());
                    break;

                case 'player_left':
                    addMessage(`${data.player_name} ç¦»å¼€äº†æ¸¸æˆ`, 'info');
                    break;

                case 'game_started':
                    addMessage('æ¸¸æˆå¼€å§‹ï¼', 'success');
                    soundEffects.dealCard();
                    document.getElementById('start-btn').style.display = 'none';
                    document.getElementById('add-ai-btn').style.display = 'none';
                    document.getElementById('game-result').classList.remove('show');
                    // æ¸…é™¤è‡ªåŠ¨å¼€å§‹å®šæ—¶å™¨
                    cancelAutoStart();
                    break;

                case 'game_state':
                    currentGameState = data;
                    // æ£€æµ‹æ–°é˜¶æ®µå¹¶æ’­æ”¾éŸ³æ•ˆ
                    if (data.game_stage === 'flop' || data.game_stage === 'turn' || data.game_stage === 'river') {
                        if (!window.lastStage || window.lastStage !== data.game_stage) {
                            soundEffects.play(() => soundEffects.flip());
                            window.lastStage = data.game_stage;
                        }
                    }
                    updateGameUI(data);
                    break;

                case 'player_action':
                    const actionText = {
                        'fold': 'å¼ƒç‰Œ âŒ',
                        'check': 'è¿‡ç‰Œ âœ“',
                        'call': 'è·Ÿæ³¨ ğŸ’µ',
                        'raise': 'åŠ æ³¨ ğŸ”¥'
                    }[data.action] || data.action;
                    addMessage(`${data.player_name || 'ç©å®¶'} ${actionText}`, 'info');
                    
                    // æ’­æ”¾ç›¸åº”éŸ³æ•ˆ
                    if (data.action === 'fold') {
                        soundEffects.play(() => soundEffects.fold());
                    } else if (data.action === 'raise') {
                        soundEffects.play(() => soundEffects.bet());
                        // æ˜¾ç¤ºåŠ æ³¨åŠ¨ç”»
                        if (data.amount) {
                            const potElement = document.getElementById('pot-amount');
                            const rect = potElement.getBoundingClientRect();
                            showActionIndicator(`åŠ æ³¨ ${data.amount}`, rect.left, rect.top - 50);
                        }
                    } else if (data.action === 'call') {
                        soundEffects.play(() => soundEffects.bet());
                        // æ˜¾ç¤ºè·Ÿæ³¨åŠ¨ç”»
                        if (data.amount) {
                            const potElement = document.getElementById('pot-amount');
                            const rect = potElement.getBoundingClientRect();
                            showActionIndicator(`è·Ÿæ³¨ ${data.amount}`, rect.left, rect.top - 50);
                        }
                    } else if (data.action === 'check') {
                        const potElement = document.getElementById('pot-amount');
                        const rect = potElement.getBoundingClientRect();
                        showActionIndicator('è¿‡ç‰Œ âœ“', rect.left, rect.top - 50);
                    }
                    break;

                case 'round_end':
                    addMessage('æœ¬è½®ç»“æŸï¼', 'success');
                    setTimeout(() => {
                        document.getElementById('start-btn').style.display = 'block';
                    }, 3000);
                    break;

                case 'error':
                    addMessage(data.message, 'error');
                    break;

                case 'info':
                    addMessage(data.message, 'success');
                    break;
                
                case 'game_ended':
                    // æ¸¸æˆç»“æŸï¼Œæ˜¾ç¤ºæœ€ç»ˆç»“æœ
                    showFinalResults(data);
                    soundEffects.play(() => soundEffects.win());
                    break;
            }
        }

        function updateGameUI(state) {
            // æ›´æ–°æ¸¸æˆä¿¡æ¯
            const stageNames = {
                'waiting': 'ç­‰å¾…ä¸­',
                'preflop': 'ç¿»ç‰Œå‰',
                'flop': 'ç¿»ç‰Œ',
                'turn': 'è½¬ç‰Œ',
                'river': 'æ²³ç‰Œ',
                'showdown': 'æ‘Šç‰Œ'
            };
            document.getElementById('game-stage').textContent = stageNames[state.game_stage] || state.game_stage;
            
            // åº•æ± æ›´æ–°åŠ¨ç”»
            const potElement = document.getElementById('pot-amount');
            const potDisplay = document.getElementById('pot-display');
            const oldPot = parseInt(potElement.textContent) || 0;
            const newPot = state.pot;
            if (oldPot !== newPot) {
                potElement.classList.add('update-animation');
                potDisplay.classList.add('update-animation');
                setTimeout(() => {
                    potElement.classList.remove('update-animation');
                    potDisplay.classList.remove('update-animation');
                }, 500);
            }
            potElement.textContent = newPot;
            potDisplay.textContent = `ğŸ’° åº•æ± : ${newPot}`;
            
            document.getElementById('current-bet').textContent = state.current_bet;

            // æ›´æ–°å…¬å…±ç‰Œï¼ˆå¸¦åŠ¨ç”»ï¼‰
            const communityCardsDiv = document.getElementById('community-cards');
            const oldCardCount = communityCardsDiv.querySelectorAll('.card').length;
            communityCardsDiv.innerHTML = '';
            
            if (state.community_cards && state.community_cards.length > 0) {
                state.community_cards.forEach((card, index) => {
                    const cardElement = createCardElement(card);
                    // æ–°å‘çš„ç‰Œæ·»åŠ åŠ¨ç”»å’Œå»¶è¿Ÿ
                    if (index >= oldCardCount) {
                        cardElement.classList.add('deal-animation');
                        cardElement.style.animationDelay = ((index - oldCardCount) * 0.1) + 's';
                        // æ’­æ”¾å‘ç‰ŒéŸ³æ•ˆ
                        setTimeout(() => {
                            soundEffects.dealCard();
                        }, (index - oldCardCount) * 100);
                    }
                    communityCardsDiv.appendChild(cardElement);
                });
            } else {
                communityCardsDiv.innerHTML = '<div style="color: #fff; opacity: 0.5;">å…¬å…±ç‰ŒåŒºåŸŸ</div>';
            }

            // æ›´æ–°ç©å®¶ä¿¡æ¯
            const playersArea = document.getElementById('players-area');
            playersArea.innerHTML = '';
            const totalPlayers = state.players.length;
            
            // é‡æ–°æ’åˆ—ç©å®¶ï¼Œè®©å½“å‰ç”¨æˆ·å§‹ç»ˆåœ¨æœ€åï¼ˆåº•éƒ¨ï¼‰
            let reorderedPlayers = [...state.players];
            const currentPlayerIndex = reorderedPlayers.findIndex(p => p.id === playerId);
            
            if (currentPlayerIndex !== -1) {
                // å°†å½“å‰ç©å®¶ç§»åˆ°æ•°ç»„æœ«å°¾
                const currentPlayer = reorderedPlayers.splice(currentPlayerIndex, 1)[0];
                reorderedPlayers.push(currentPlayer);
            }
            
            reorderedPlayers.forEach((player, index) => {
                const playerCard = createPlayerCard(player, state.current_player_id, index, totalPlayers);
                playersArea.appendChild(playerCard);
            });

            // æ›´æ–°æ“ä½œæŒ‰é’®
            const actionButtons = document.getElementById('action-buttons');
            if (state.game_stage !== 'waiting' && state.game_stage !== 'showdown' && 
                state.current_player_id === playerId) {
                actionButtons.classList.add('show');
                
                // æ›´æ–°åŠ æ³¨è¾“å…¥æ¡†çš„å ä½ç¬¦å’Œæœ€å°å€¼
                const raiseInput = document.getElementById('raise-amount');
                const currentPlayer = state.players.find(p => p.id === playerId);
                if (currentPlayer && raiseInput) {
                    const callAmount = state.current_bet - currentPlayer.bet;
                    const minRaiseIncrement = Math.max(state.min_raise || state.big_blind, state.big_blind);
                    const minRaiseTotal = callAmount + minRaiseIncrement;
                    
                    raiseInput.placeholder = `æœ€å°‘ ${minRaiseTotal} (å«è·Ÿæ³¨${callAmount})`;
                    raiseInput.min = minRaiseTotal;
                    
                    // æ›´æ–°è·Ÿæ³¨æŒ‰é’®æ–‡æœ¬
                    const callBtn = document.querySelector('.btn-call');
                    if (callBtn) {
                        if (callAmount > 0) {
                            callBtn.textContent = `è·Ÿæ³¨ ${callAmount}`;
                        } else {
                            callBtn.textContent = 'è·Ÿæ³¨';
                        }
                    }
                }
            } else {
                actionButtons.classList.remove('show');
            }

            // æ˜¾ç¤ºæ¸¸æˆç»“æœ
            if (state.game_stage === 'showdown' && state.game_result) {
                showGameResult(state.game_result);
            } else {
                document.getElementById('game-result').classList.remove('show');
            }
            
            // æ˜¾ç¤º/éšè—ç»“æŸæ¸¸æˆæŒ‰é’®ï¼ˆä»…æˆ¿ä¸»å¯è§ï¼‰
            const endGameBtn = document.getElementById('end-game-btn');
            if (state.room_owner_id === playerId && !state.game_ended) {
                endGameBtn.style.display = 'inline-block';
            } else {
                endGameBtn.style.display = 'none';
            }
            
            // å¯åŠ¨æˆ–åœæ­¢å€’è®¡æ—¶
            if (state.game_stage !== 'waiting' && state.game_stage !== 'showdown') {
                if (state.current_player_id === playerId) {
                    // è½®åˆ°å½“å‰ç©å®¶ï¼Œå¯åŠ¨å€’è®¡æ—¶
                    startTurnTimer();
                } else {
                    // ä¸æ˜¯å½“å‰ç©å®¶ï¼Œå¯åŠ¨AIå€’è®¡æ—¶æ˜¾ç¤º
                    startAITimer();
                }
            } else {
                stopTurnTimer();
                stopAITimer();
            }
            
            // å¦‚æœæ¸¸æˆå·²ç»“æŸï¼Œæ˜¾ç¤ºæœ€ç»ˆç»“æœ
            if (state.game_ended && state.final_results) {
                showFinalResults(state.final_results);
            }
        }

        function createCardElement(card) {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'card';
            
            // ç¡®å®šèŠ±è‰²ç±»
            if (card.suit === 'â™¥' || card.suit === 'â™¦') {
                cardDiv.classList.add('hearts');
            } else {
                cardDiv.classList.add('clubs');
            }
            
            cardDiv.innerHTML = `
                <div style="font-size: 32px;">${card.suit}</div>
                <div style="font-size: 28px; font-weight: bold;">${card.rank}</div>
            `;
            return cardDiv;
        }
        
        // è®¡ç®—æ¤­åœ†æ¡Œå­å‘¨å›´çš„åº§ä½ä½ç½®
        function calculateSeatPosition(playerIndex, totalPlayers) {
            // æ¤­åœ†å‚æ•° (ç›¸å¯¹äºæ¡Œå­ä¸­å¿ƒ)
            const tableWidth = 1000;  // æ¡Œå­å®½åº¦
            const tableHeight = 600;  // æ¡Œå­é«˜åº¦
            const radiusX = tableWidth / 2 + 100;  // æ¨ªå‘åŠå¾„ï¼ˆç©å®¶è·ç¦»ä¸­å¿ƒï¼‰
            const radiusY = tableHeight / 2 + 80;   // çºµå‘åŠå¾„
            
            // è®¡ç®—è§’åº¦åˆ†å¸ƒï¼Œåº•éƒ¨ä¸­é—´ä¸º0åº¦ä½ç½®
            // è§’åº¦ä»åº•éƒ¨é€†æ—¶é’ˆåˆ†å¸ƒ
            let angle;
            
            if (totalPlayers === 1) {
                angle = 90; // å•äººæ—¶åœ¨åº•éƒ¨
            } else if (totalPlayers === 2) {
                angle = playerIndex === 0 ? 90 : 270; // ä¸¤äººå¯¹å
            } else {
                // å¤šäººæ—¶å‡åŒ€åˆ†å¸ƒåœ¨æ¤­åœ†å‘¨å›´ï¼Œä»åº•éƒ¨å¼€å§‹
                // é¿å…é¡¶éƒ¨åŒºåŸŸï¼ˆç•™ç»™æ¸¸æˆä¿¡æ¯æ˜¾ç¤ºï¼‰
                const startAngle = 30;  // ä»å³ä¸‹è§’å¼€å§‹ï¼ˆæ›´é å³ï¼‰
                const endAngle = 330;   // åˆ°å·¦ä¸‹è§’ç»“æŸï¼ˆæ›´é å·¦ï¼‰
                const angleRange = endAngle - startAngle;
                angle = startAngle + (angleRange / (totalPlayers - 1)) * playerIndex;
            }
            
            // è½¬æ¢ä¸ºå¼§åº¦
            const radian = (angle * Math.PI) / 180;
            
            // è®¡ç®—ä½ç½® (ç›¸å¯¹äºæ¡Œå­ä¸­å¿ƒ)
            const x = Math.cos(radian) * radiusX;
            const y = Math.sin(radian) * radiusY;
            
            return {
                left: `calc(50% + ${x}px)`,
                top: `calc(50% - ${y}px)`,
                transform: 'translate(-50%, -50%)'
            };
        }
        
        // ç”Ÿæˆç©å®¶å¤´åƒé¢œè‰²å’Œå­—æ¯
        function generateAvatar(playerName, isAI) {
            // é¢„å®šä¹‰çš„é¢œè‰²æ–¹æ¡ˆ
            const colors = [
                'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
                'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
                'linear-gradient(135deg, #30cfd0 0%, #330867 100%)',
                'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)',
                'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)',
                'linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)',
                'linear-gradient(135deg, #ff6e7f 0%, #bfe9ff 100%)',
            ];
            
            // æ ¹æ®åå­—ç”Ÿæˆä¸€ä¸ªä¸€è‡´çš„é¢œè‰²ç´¢å¼•
            let hash = 0;
            for (let i = 0; i < playerName.length; i++) {
                hash = playerName.charCodeAt(i) + ((hash << 5) - hash);
            }
            const colorIndex = Math.abs(hash) % colors.length;
            
            // è·å–åå­—çš„é¦–å­—æ¯
            const initial = playerName.charAt(0).toUpperCase();
            
            return {
                color: colors[colorIndex],
                initial: initial,
                isAI: isAI
            };
        }

        function createPlayerCard(player, currentPlayerId, playerIndex, totalPlayers) {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'player-card';
            
            // æ ‡è®°å½“å‰ç”¨æˆ·
            if (player.id === playerId) {
                cardDiv.classList.add('current-user');
            }
            
            if (player.id === currentPlayerId) {
                cardDiv.classList.add('current-turn');
            }
            
            if (player.folded) {
                cardDiv.classList.add('folded');
            }
            
            if (player.is_dealer) {
                cardDiv.classList.add('dealer');
            }

            let statusText = '';
            if (player.folded) {
                statusText = 'å·²å¼ƒç‰Œ';
            } else if (player.all_in) {
                statusText = 'ALL IN';
            }
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯AIç©å®¶
            const isAI = player.name && player.name.startsWith('æœºå™¨äºº');
            
            // ç”Ÿæˆå¤´åƒ
            const avatar = generateAvatar(player.name, isAI);
            const avatarHTML = `
                <div class="player-avatar ${isAI ? 'ai' : ''}" style="background: ${avatar.color};">
                    ${avatar.initial}
                </div>
            `;

            let handHTML = '';
            if (player.hand && player.hand.length > 0) {
                handHTML = '<div class="player-hand">';
                player.hand.forEach(card => {
                    handHTML += `<div class="card ${card.suit === 'â™¥' || card.suit === 'â™¦' ? 'hearts' : 'clubs'}">
                        <div style="font-size: 24px;">${card.suit}</div>
                        <div style="font-size: 20px;">${card.rank}</div>
                    </div>`;
                });
                handHTML += '</div>';
            } else if (!player.folded && currentGameState && currentGameState.game_stage !== 'waiting') {
                handHTML = '<div class="player-hand">';
                handHTML += '<div class="card card-back">ğŸ‚ </div>';
                handHTML += '<div class="card card-back">ğŸ‚ </div>';
                handHTML += '</div>';
            }

            // ç»Ÿè®¡ä¿¡æ¯
            const totalWinClass = player.total_win >= 0 ? 'stat-positive' : 'stat-negative';
            const winRate = player.games_played > 0 ? ((player.games_won / player.games_played) * 100).toFixed(1) : 0;
            
            let statsHTML = '';
            if (player.games_played > 0) {
                statsHTML = `
                    <div class="player-stats">
                        <div class="player-stats-item">
                            <span>è¾“èµ¢:</span>
                            <span class="${totalWinClass}">${player.total_win >= 0 ? '+' : ''}${player.total_win}</span>
                        </div>
                        <div class="player-stats-item">
                            <span>èƒœç‡:</span>
                            <span>${winRate}% (${player.games_won}/${player.games_played})</span>
                        </div>
                        ${player.rebuys > 0 ? `
                        <div class="player-stats-item">
                            <span>è¡¥ç :</span>
                            <span class="stat-negative">${player.rebuys}æ¬¡</span>
                        </div>
                        ` : ''}
                    </div>
                `;
            }

            cardDiv.innerHTML = `
                ${avatarHTML}
                <div class="player-name">${player.name}</div>
                <div class="player-chips">ğŸ’° ç­¹ç : ${player.chips}</div>
                <div class="player-bet">ğŸ¯ ä¸‹æ³¨: ${player.bet}</div>
                ${statusText ? `<div class="player-status">${statusText}</div>` : ''}
                ${handHTML}
                ${statsHTML}
            `;
            
            // å¦‚æœæ˜¯å½“å‰å›åˆç©å®¶ï¼Œæ·»åŠ å€’è®¡æ—¶æ˜¾ç¤º
            if (player.id === currentPlayerId) {
                const timerHTML = `
                    <div class="turn-timer" id="turn-timer-${player.id}">
                        <div class="turn-timer-bar" id="turn-timer-bar-${player.id}" style="width: 100%;">
                            <span id="turn-timer-text-${player.id}">${gameSettings.turnTimeout}</span>
                        </div>
                    </div>
                `;
                cardDiv.innerHTML += timerHTML;
            }
            
            // åº”ç”¨åº§ä½ä½ç½®
            if (playerIndex !== undefined && totalPlayers !== undefined) {
                const position = calculateSeatPosition(playerIndex, totalPlayers);
                cardDiv.style.left = position.left;
                cardDiv.style.top = position.top;
                cardDiv.style.transform = position.transform;
            }

            return cardDiv;
        }

        function showGameResult(result) {
            const resultDiv = document.getElementById('game-result');
            
            // æ’­æ”¾è·èƒœéŸ³æ•ˆ
            soundEffects.play(() => soundEffects.win());
            
            let html = '<div class="result-title">ğŸ‰ æ¸¸æˆç»“æœ ğŸ‰</div>';
            
            // æ˜¾ç¤ºè·èƒœè€…
            if (result.winners && result.winners.length > 0) {
                const winnerNames = result.winners.map(w => w.name).join(', ');
                const winnerHand = result.winners[0].hand_name;
                html += `<div class="winner-info">`;
                html += `<div>ğŸ† è·èƒœè€…: ${winnerNames}</div>`;
                html += `<div>ç‰Œå‹: ${winnerHand}</div>`;
                html += `<div>èµ¢å¾—: ${result.win_amount} ç­¹ç </div>`;
                html += `</div>`;
            }
            
            // æ˜¾ç¤ºæ‰€æœ‰ç©å®¶çš„æ‰‹ç‰Œ
            if (result.player_hands && result.player_hands.length > 0) {
                html += '<div style="margin-top: 20px;">';
                html += '<div style="font-size: 20px; margin-bottom: 10px; text-align: center;">æ‰€æœ‰ç©å®¶æ‰‹ç‰Œ</div>';
                
                result.player_hands.forEach(ph => {
                    const isWinner = ph.is_winner;
                    html += `<div class="player-result ${isWinner ? 'winner' : ''}">`;
                    html += `<div>`;
                    html += `<div class="player-result-name">${ph.name} ${isWinner ? 'ğŸ‘‘' : ''}</div>`;
                    html += `<div class="player-result-type">${ph.hand_name}</div>`;
                    html += `</div>`;
                    html += `<div class="player-result-hand">`;
                    ph.hand.forEach(card => {
                        const color = (card.suit === 'â™¥' || card.suit === 'â™¦') ? 'hearts' : 'clubs';
                        html += `<div class="card ${color}">`;
                        html += `<div style="font-size: 24px;">${card.suit}</div>`;
                        html += `<div style="font-size: 20px;">${card.rank}</div>`;
                        html += `</div>`;
                    });
                    html += `</div>`;
                    html += `</div>`;
                });
                
                html += '</div>';
            }
            
            // æ·»åŠ è‡ªåŠ¨å¼€å§‹å€’è®¡æ—¶æç¤º
            html += `
                <div id="auto-start-info">
                    <div style="font-size: 18px; margin-bottom: 10px;">â±ï¸ ä¸‹ä¸€å±€å°†åœ¨ <span id="countdown">5</span> ç§’åè‡ªåŠ¨å¼€å§‹</div>
                    <button id="cancel-auto-start" onclick="cancelAutoStart()">å–æ¶ˆè‡ªåŠ¨å¼€å§‹</button>
                </div>
            `;
            
            resultDiv.innerHTML = html;
            resultDiv.classList.add('show');
            
            // å¯åŠ¨è‡ªåŠ¨å¼€å§‹å€’è®¡æ—¶
            startAutoStart(5);
            
            // 2ç§’åæ˜¾ç¤ºå¼€å§‹æŒ‰é’®
            setTimeout(() => {
                document.getElementById('start-btn').style.display = 'block';
                document.getElementById('add-ai-btn').style.display = 'block';
            }, 2000);
        }

        function startGame() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                soundEffects.play(() => soundEffects.notify());
                ws.send(JSON.stringify({ type: 'start_game' }));
                // æ¸…é™¤è‡ªåŠ¨å¼€å§‹å®šæ—¶å™¨
                cancelAutoStart();
            }
        }

        // å¯åŠ¨è‡ªåŠ¨å¼€å§‹å€’è®¡æ—¶
        function startAutoStart(seconds) {
            // æ£€æŸ¥æ˜¯å¦å¯ç”¨è‡ªåŠ¨å¼€å§‹
            if (!gameSettings.autoStartEnabled) {
                return;
            }
            
            // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
            cancelAutoStart();
            
            let remainingSeconds = seconds;
            
            // æ›´æ–°å€’è®¡æ—¶æ˜¾ç¤º
            const updateCountdown = () => {
                const countdownElement = document.getElementById('countdown');
                if (countdownElement) {
                    countdownElement.textContent = remainingSeconds;
                    
                    // æœ€å3ç§’æ’­æ”¾æç¤ºéŸ³
                    if (remainingSeconds <= 3 && remainingSeconds > 0) {
                        soundEffects.play(() => soundEffects.notify());
                    }
                }
            };
            
            // ç«‹å³æ›´æ–°ä¸€æ¬¡
            updateCountdown();
            
            // æ¯ç§’æ›´æ–°å€’è®¡æ—¶
            autoStartCountdown = setInterval(() => {
                remainingSeconds--;
                
                if (remainingSeconds > 0) {
                    updateCountdown();
                } else {
                    // å€’è®¡æ—¶ç»“æŸï¼Œè‡ªåŠ¨å¼€å§‹æ¸¸æˆ
                    clearInterval(autoStartCountdown);
                    autoStartCountdown = null;
                    
                    // å»¶è¿Ÿ100msåå¼€å§‹æ¸¸æˆ
                    autoStartTimer = setTimeout(() => {
                        startGame();
                        addMessage('è‡ªåŠ¨å¼€å§‹ä¸‹ä¸€å±€...', 'success');
                    }, 100);
                }
            }, 1000);
        }

        // å–æ¶ˆè‡ªåŠ¨å¼€å§‹
        function cancelAutoStart() {
            if (autoStartTimer) {
                clearTimeout(autoStartTimer);
                autoStartTimer = null;
            }
            
            if (autoStartCountdown) {
                clearInterval(autoStartCountdown);
                autoStartCountdown = null;
            }
            
            // éšè—å€’è®¡æ—¶æç¤º
            const autoStartInfo = document.getElementById('auto-start-info');
            if (autoStartInfo) {
                autoStartInfo.style.display = 'none';
                addMessage('å·²å–æ¶ˆè‡ªåŠ¨å¼€å§‹', 'info');
            }
        }

        function addAIPlayer() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                soundEffects.play(() => soundEffects.notify());
                ws.send(JSON.stringify({ 
                    type: 'add_ai',
                    count: 1 
                }));
                addMessage('æ­£åœ¨æ·»åŠ AIç©å®¶...', 'info');
            }
        }

        // å¿«æ·åŠ æ³¨å‡½æ•°
        function quickRaise(type) {
            if (!currentGameState || !playerId) {
                addMessage('æ¸¸æˆçŠ¶æ€æœªåŠ è½½', 'error');
                return;
            }
            
            const currentPlayer = currentGameState.players.find(p => p.id === playerId);
            if (!currentPlayer) {
                addMessage('æœªæ‰¾åˆ°ç©å®¶ä¿¡æ¯', 'error');
                return;
            }
            
            const callAmount = currentGameState.current_bet - currentPlayer.bet;
            const pot = currentGameState.pot;
            const minRaiseIncrement = Math.max(currentGameState.min_raise || currentGameState.big_blind, currentGameState.big_blind);
            let raiseAmount = 0;
            
            switch(type) {
                case 'min':
                    // æœ€å°åŠ æ³¨ï¼šè·Ÿæ³¨ + æœ€å°åŠ æ³¨å¢é‡
                    raiseAmount = callAmount + minRaiseIncrement;
                    break;
                case 'half':
                    // åŠæ± ï¼šè·Ÿæ³¨ + 0.5å€åº•æ± 
                    raiseAmount = callAmount + Math.floor(pot * 0.5);
                    // ç¡®ä¿ä¸ä½äºæœ€å°åŠ æ³¨
                    raiseAmount = Math.max(raiseAmount, callAmount + minRaiseIncrement);
                    break;
                case 'pot':
                    // å…¨æ± ï¼šè·Ÿæ³¨ + 1å€åº•æ± 
                    raiseAmount = callAmount + pot;
                    // ç¡®ä¿ä¸ä½äºæœ€å°åŠ æ³¨
                    raiseAmount = Math.max(raiseAmount, callAmount + minRaiseIncrement);
                    break;
                case 'allin':
                    // All-Inï¼šæ‰€æœ‰ç­¹ç 
                    raiseAmount = currentPlayer.chips;
                    break;
            }
            
            // é™åˆ¶åœ¨ç©å®¶ç­¹ç èŒƒå›´å†…
            raiseAmount = Math.min(raiseAmount, currentPlayer.chips);
            
            // è®¾ç½®åˆ°è¾“å…¥æ¡†
            const raiseInput = document.getElementById('raise-amount');
            raiseInput.value = raiseAmount;
            
            // è§†è§‰åé¦ˆ
            raiseInput.style.background = 'rgba(76, 175, 80, 0.2)';
            setTimeout(() => {
                raiseInput.style.background = '';
            }, 500);
            
            // æ’­æ”¾éŸ³æ•ˆ
            soundEffects.play(() => soundEffects.notify());
        }

        function playerAction(action) {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                addMessage('æœªè¿æ¥åˆ°æœåŠ¡å™¨', 'error');
                return;
            }

            let amount = 0;
            if (action === 'raise') {
                const inputAmount = parseInt(document.getElementById('raise-amount').value) || 0;
                
                if (inputAmount <= 0) {
                    addMessage('è¯·è¾“å…¥æœ‰æ•ˆçš„åŠ æ³¨é‡‘é¢', 'error');
                    soundEffects.play(() => soundEffects.notify());
                    return;
                }
                
                // è·å–å½“å‰ç©å®¶ä¿¡æ¯
                const currentPlayer = currentGameState.players.find(p => p.id === playerId);
                if (!currentPlayer) {
                    addMessage('æœªæ‰¾åˆ°ç©å®¶ä¿¡æ¯', 'error');
                    return;
                }
                
                // è®¡ç®—è·Ÿæ³¨é‡‘é¢
                const callAmount = currentGameState.current_bet - currentPlayer.bet;
                // è®¡ç®—åŠ æ³¨å¢é‡
                const raiseIncrement = inputAmount - callAmount;
                
                // æ£€æŸ¥æ˜¯å¦all-in
                const isAllIn = inputAmount >= currentPlayer.chips;
                
                if (!isAllIn) {
                    // ä¸æ˜¯all-inæ—¶ï¼Œæ£€æŸ¥æœ€å°åŠ æ³¨é‡
                    const minRaiseIncrement = Math.max(currentGameState.min_raise || currentGameState.big_blind, currentGameState.big_blind);
                    
                    if (raiseIncrement < minRaiseIncrement) {
                        addMessage(`åŠ æ³¨å¢é‡è‡³å°‘éœ€è¦ ${minRaiseIncrement} ç­¹ç ï¼ˆå½“å‰å¢é‡ï¼š${raiseIncrement}ï¼‰`, 'error');
                        soundEffects.play(() => soundEffects.notify());
                        return;
                    }
                }
                
                // æ£€æŸ¥ç­¹ç æ˜¯å¦è¶³å¤Ÿ
                if (inputAmount > currentPlayer.chips) {
                    addMessage(`ç­¹ç ä¸è¶³ï¼Œæœ€å¤šå¯ä¸‹æ³¨ ${currentPlayer.chips}ï¼ˆAll-Inï¼‰`, 'error');
                    soundEffects.play(() => soundEffects.notify());
                    return;
                }
                
                amount = inputAmount;
            }

            // æ’­æ”¾ç‚¹å‡»éŸ³æ•ˆ
            if (action === 'fold') {
                soundEffects.play(() => soundEffects.fold());
            } else if (action === 'check') {
                soundEffects.play(() => soundEffects.notify());
            } else {
                soundEffects.play(() => soundEffects.bet());
            }

            ws.send(JSON.stringify({
                type: 'action',
                action: action,
                amount: amount
            }));

            // æ¸…ç©ºåŠ æ³¨è¾“å…¥æ¡†
            if (action === 'raise') {
                document.getElementById('raise-amount').value = '';
            }
        }

        // å†å²è®°å½•åŠŸèƒ½
        async function toggleHistory() {
            const panel = document.getElementById('history-panel');
            const btn = document.querySelector('#history-btn');
            
            if (panel.classList.contains('hidden')) {
                panel.classList.remove('hidden');
                if (btn) btn.textContent = 'ğŸ“œ ç‰Œå±€å›é¡¾ âœ“';
                await loadGameHistory();
            } else {
                panel.classList.add('hidden');
                if (btn) btn.textContent = 'ğŸ“œ ç‰Œå±€å›é¡¾';
            }
        }

        async function loadGameHistory() {
            try {
                const response = await fetch(`${basePath}/api/game_history?limit=10`);
                const data = await response.json();
                displayGameHistory(data.history);
            } catch (error) {
                document.getElementById('history-content').innerHTML = 
                    '<p style="text-align: center; color: #f44336;">åŠ è½½å†å²è®°å½•å¤±è´¥</p>';
            }
        }

        function displayGameHistory(history) {
            const content = document.getElementById('history-content');
            
            if (!history || history.length === 0) {
                content.innerHTML = '<p style="text-align: center; opacity: 0.7;">æš‚æ— å†å²è®°å½•</p>';
                return;
            }

            let html = '';
            history.reverse().forEach(game => {
                const date = new Date(game.timestamp);
                const timeStr = date.toLocaleTimeString('zh-CN');
                
                html += `
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; margin: 10px 0; border-radius: 8px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <strong>ç¬¬ ${game.game_number} å±€</strong>
                            <span style="opacity: 0.7;">${timeStr}</span>
                        </div>
                        
                        <div style="margin: 10px 0;">
                            <strong>å…¬å…±ç‰Œï¼š</strong>
                            ${game.community_cards.map(c => 
                                `<span style="background: rgba(255,255,255,0.2); padding: 2px 8px; margin: 2px; border-radius: 4px;">${c.suit}${c.rank}</span>`
                            ).join('')}
                        </div>
                        
                        <div style="margin: 10px 0;">
                            <strong>è·èƒœè€…ï¼š</strong>
                            ${game.result.winners.map(w => 
                                `<span style="color: #FFD700;">${w.name}</span> (${w.hand_name})`
                            ).join(', ')}
                            <br>
                            <span style="color: #4CAF50;">èµ¢å¾— ${game.result.win_amount} ç­¹ç </span>
                        </div>
                        
                        <details style="margin-top: 10px;">
                            <summary style="cursor: pointer; opacity: 0.8;">æŸ¥çœ‹è¯¦æƒ…</summary>
                            <div style="margin-top: 10px; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 5px;">
                                <div><strong>ç©å®¶æ‰‹ç‰Œï¼š</strong></div>
                                ${game.players.map(p => `
                                    <div style="margin: 5px 0; padding: 5px; ${p.folded ? 'opacity: 0.5;' : ''}">
                                        ${p.name}: 
                                        ${p.hand.map(c => `${c.suit}${c.rank}`).join(' ')}
                                        ${p.folded ? ' (å·²å¼ƒç‰Œ)' : ''}
                                    </div>
                                `).join('')}
                                
                                <div style="margin-top: 10px;"><strong>æ“ä½œè®°å½•ï¼š</strong></div>
                                ${game.actions.map(action => {
                                    const actionText = {
                                        'fold': 'å¼ƒç‰Œ',
                                        'check': 'è¿‡ç‰Œ',
                                        'call': 'è·Ÿæ³¨',
                                        'raise': 'åŠ æ³¨'
                                    }[action.action] || action.action;
                                    const stageText = {
                                        'preflop': 'ç¿»ç‰Œå‰',
                                        'flop': 'ç¿»ç‰Œ',
                                        'turn': 'è½¬ç‰Œ',
                                        'river': 'æ²³ç‰Œ'
                                    }[action.stage] || action.stage;
                                    return `
                                        <div style="margin: 3px 0; font-size: 12px; opacity: 0.8;">
                                            [${stageText}] ${action.player_name}: ${actionText}
                                            ${action.amount > 0 ? ` (${action.amount})` : ''}
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </details>
                    </div>
                `;
            });
            
            content.innerHTML = html;
        }

        // æ’è¡Œæ¦œåŠŸèƒ½
        function toggleLeaderboard() {
            const panel = document.getElementById('leaderboard-panel');
            const btn = document.querySelector('#leaderboard-btn');
            
            if (panel.classList.contains('hidden')) {
                panel.classList.remove('hidden');
                if (btn) btn.textContent = 'ğŸ† æ’è¡Œæ¦œ âœ“';
                updateLeaderboard();
            } else {
                panel.classList.add('hidden');
                if (btn) btn.textContent = 'ğŸ† æ’è¡Œæ¦œ';
            }
        }

        function updateLeaderboard() {
            if (!currentGameState || !currentGameState.players) {
                document.getElementById('leaderboard-content').innerHTML = 
                    '<p style="text-align: center; opacity: 0.7;">æš‚æ— æ•°æ®</p>';
                return;
            }

            const players = [...currentGameState.players];
            
            // æŒ‰ç´¯è®¡è¾“èµ¢æ’åº
            players.sort((a, b) => b.total_win - a.total_win);
            
            let html = `
                <div style="margin-bottom: 20px;">
                    <div style="display: flex; gap: 10px; justify-content: center; margin-bottom: 15px;">
                        <button onclick="sortLeaderboard('total_win')" class="btn-start" style="padding: 8px 15px; font-size: 14px;">
                            æŒ‰è¾“èµ¢æ’åº
                        </button>
                        <button onclick="sortLeaderboard('win_rate')" class="btn-start" style="padding: 8px 15px; font-size: 14px; background: #FF9800;">
                            æŒ‰èƒœç‡æ’åº
                        </button>
                        <button onclick="sortLeaderboard('chips')" class="btn-start" style="padding: 8px 15px; font-size: 14px; background: #2196F3;">
                            æŒ‰ç­¹ç æ’åº
                        </button>
                    </div>
                </div>
                
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: rgba(255,255,255,0.1);">
                            <th style="padding: 10px; text-align: left;">æ’å</th>
                            <th style="padding: 10px; text-align: left;">ç©å®¶</th>
                            <th style="padding: 10px; text-align: right;">ç­¹ç </th>
                            <th style="padding: 10px; text-align: right;">è¾“èµ¢</th>
                            <th style="padding: 10px; text-align: right;">èƒœç‡</th>
                            <th style="padding: 10px; text-align: right;">æˆ˜ç»©</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            players.forEach((player, index) => {
                const rank = index + 1;
                const medal = rank === 1 ? 'ğŸ¥‡' : rank === 2 ? 'ğŸ¥ˆ' : rank === 3 ? 'ğŸ¥‰' : `${rank}`;
                const winRate = player.games_played > 0 
                    ? ((player.games_won / player.games_played) * 100).toFixed(1) 
                    : 0;
                const totalWinClass = player.total_win >= 0 ? 'stat-positive' : 'stat-negative';
                
                html += `
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                        <td style="padding: 10px; font-size: 20px;">${medal}</td>
                        <td style="padding: 10px;">
                            ${player.name}
                            ${player.rebuys > 0 ? `<span style="opacity: 0.6; font-size: 12px;">(è¡¥${player.rebuys})</span>` : ''}
                        </td>
                        <td style="padding: 10px; text-align: right; color: #FFD700;">
                            ${player.chips}
                        </td>
                        <td style="padding: 10px; text-align: right;" class="${totalWinClass}">
                            ${player.total_win >= 0 ? '+' : ''}${player.total_win}
                        </td>
                        <td style="padding: 10px; text-align: right;">
                            ${winRate}%
                        </td>
                        <td style="padding: 10px; text-align: right;">
                            ${player.games_won}/${player.games_played}
                        </td>
                    </tr>
                `;
            });
            
            html += `
                    </tbody>
                </table>
            `;
            
            document.getElementById('leaderboard-content').innerHTML = html;
        }

        function sortLeaderboard(sortBy) {
            if (!currentGameState || !currentGameState.players) return;
            
            const players = [...currentGameState.players];
            
            if (sortBy === 'total_win') {
                players.sort((a, b) => b.total_win - a.total_win);
            } else if (sortBy === 'win_rate') {
                players.sort((a, b) => {
                    const rateA = a.games_played > 0 ? a.games_won / a.games_played : 0;
                    const rateB = b.games_played > 0 ? b.games_won / b.games_played : 0;
                    return rateB - rateA;
                });
            } else if (sortBy === 'chips') {
                players.sort((a, b) => b.chips - a.chips);
            }
            
            currentGameState.players = players;
            updateLeaderboard();
        }
        
        // è¡ŒåŠ¨å€’è®¡æ—¶ç›¸å…³å‡½æ•°
        function startTurnTimer() {
            stopTurnTimer(); // å…ˆåœæ­¢ä¹‹å‰çš„è®¡æ—¶å™¨
            
            if (!currentGameState || !playerId) return;
            
            turnTimeRemaining = gameSettings.turnTimeout;
            
            const currentPlayer = currentGameState.players.find(p => p.id === currentGameState.current_player_id);
            if (!currentPlayer) return;
            
            updateTurnTimerDisplay();
            
            turnTimer = setInterval(() => {
                turnTimeRemaining--;
                
                if (turnTimeRemaining <= 0) {
                    // è¶…æ—¶ï¼Œè‡ªåŠ¨å¼ƒç‰Œ
                    stopTurnTimer();
                    addMessage('æ“ä½œè¶…æ—¶ï¼Œè‡ªåŠ¨å¼ƒç‰Œ', 'error');
                    soundEffects.play(() => soundEffects.notify());
                    playerAction('fold');
                } else {
                    updateTurnTimerDisplay();
                }
            }, 1000);
        }
        
        function stopTurnTimer() {
            if (turnTimer) {
                clearInterval(turnTimer);
                turnTimer = null;
            }
            turnTimeRemaining = 0;
        }
        
        // AIå€’è®¡æ—¶ç›¸å…³
        let aiTimer = null;
        let aiTimeRemaining = 0;
        
        function startAITimer() {
            stopAITimer();
            
            if (!currentGameState || !currentGameState.current_player_id) return;
            
            // AIæ€è€ƒæ—¶é—´ä¸º1-3ç§’éšæœºï¼Œè¿™é‡Œè®¾ç½®ä¸º3ç§’ä½œä¸ºæœ€å¤§å€¼
            const aiThinkTime = 3;
            aiTimeRemaining = aiThinkTime;
            
            const currentPlayer = currentGameState.players.find(p => p.id === currentGameState.current_player_id);
            if (!currentPlayer) return;
            
            updateAITimerDisplay();
            
            aiTimer = setInterval(() => {
                aiTimeRemaining--;
                
                if (aiTimeRemaining <= 0) {
                    stopAITimer();
                } else {
                    updateAITimerDisplay();
                }
            }, 1000);
        }
        
        function stopAITimer() {
            if (aiTimer) {
                clearInterval(aiTimer);
                aiTimer = null;
            }
            aiTimeRemaining = 0;
            
            // æ¸…é™¤AIå€’è®¡æ—¶æ˜¾ç¤º
            if (currentGameState && currentGameState.players) {
                currentGameState.players.forEach(player => {
                    const timerBar = document.getElementById(`turn-timer-bar-${player.id}`);
                    const timerText = document.getElementById(`turn-timer-text-${player.id}`);
                    if (timerBar && timerText && player.id !== playerId) {
                        timerBar.style.width = '0%';
                        timerText.textContent = '';
                        timerBar.classList.remove('warning');
                    }
                });
            }
        }
        
        function updateAITimerDisplay() {
            if (!currentGameState || !currentGameState.current_player_id) return;
            
            // åªæ›´æ–°AIç©å®¶çš„å€’è®¡æ—¶
            const currentPlayer = currentGameState.players.find(p => p.id === currentGameState.current_player_id);
            if (!currentPlayer || currentPlayer.id === playerId) return;
            
            const timerBar = document.getElementById(`turn-timer-bar-${currentPlayer.id}`);
            const timerText = document.getElementById(`turn-timer-text-${currentPlayer.id}`);
            
            if (timerBar && timerText) {
                const aiThinkTime = 3;
                const percentage = (aiTimeRemaining / aiThinkTime) * 100;
                timerBar.style.width = percentage + '%';
                timerText.textContent = aiTimeRemaining + 's';
                
                // æ—¶é—´ä¸è¶³1ç§’æ—¶æ·»åŠ è­¦å‘ŠåŠ¨ç”»
                if (aiTimeRemaining <= 1) {
                    timerBar.classList.add('warning');
                } else {
                    timerBar.classList.remove('warning');
                }
            }
        }
        
        function updateTurnTimerDisplay() {
            if (!currentGameState || !currentGameState.current_player_id) return;
            
            const timerBar = document.getElementById(`turn-timer-bar-${currentGameState.current_player_id}`);
            const timerText = document.getElementById(`turn-timer-text-${currentGameState.current_player_id}`);
            
            if (timerBar && timerText) {
                const percentage = (turnTimeRemaining / gameSettings.turnTimeout) * 100;
                timerBar.style.width = percentage + '%';
                timerText.textContent = turnTimeRemaining + 's';
                
                // æ—¶é—´ä¸è¶³5ç§’æ—¶æ·»åŠ è­¦å‘ŠåŠ¨ç”»
                if (turnTimeRemaining <= 5) {
                    timerBar.classList.add('warning');
                } else {
                    timerBar.classList.remove('warning');
                }
            }
        }

        // ç»“æŸæ¸¸æˆå‡½æ•°
        function endGame() {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                addMessage('æœªè¿æ¥åˆ°æœåŠ¡å™¨', 'error');
                return;
            }
            
            if (confirm('ç¡®å®šè¦ç»“æŸæ¸¸æˆå—ï¼Ÿè¿™å°†æ˜¾ç¤ºæœ€ç»ˆæ’åã€‚')) {
                ws.send(JSON.stringify({ type: 'end_game' }));
            }
        }

        // æ˜¾ç¤ºæœ€ç»ˆç»“æœ
        function showFinalResults(results) {
            const panel = document.getElementById('final-results-panel');
            const content = document.getElementById('final-results-content');
            
            let html = `
                <div style="text-align: center; margin-bottom: 30px;">
                    <p style="font-size: 20px;">æ€»å…±è¿›è¡Œäº† <strong>${results.total_games}</strong> å±€æ¸¸æˆ</p>
                </div>
                
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: rgba(255,215,0,0.2); border: 2px solid #FFD700;">
                            <th style="padding: 15px; text-align: left; font-size: 18px;">æ’å</th>
                            <th style="padding: 15px; text-align: left; font-size: 18px;">ç©å®¶</th>
                            <th style="padding: 15px; text-align: right; font-size: 18px;">æ€»è¾“èµ¢</th>
                            <th style="padding: 15px; text-align: right; font-size: 18px;">æœ€ç»ˆç­¹ç </th>
                            <th style="padding: 15px; text-align: right; font-size: 18px;">èƒœç‡</th>
                            <th style="padding: 15px; text-align: right; font-size: 18px;">æˆ˜ç»©</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            results.rankings.forEach((player, index) => {
                const medal = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : `${player.rank}`;
                const rowStyle = index === 0 ? 'background: rgba(255,215,0,0.3); border: 2px solid #FFD700;' : 
                                index === 1 ? 'background: rgba(192,192,192,0.2);' :
                                index === 2 ? 'background: rgba(205,127,50,0.2);' : '';
                const totalWinClass = player.total_win >= 0 ? 'stat-positive' : 'stat-negative';
                
                html += `
                    <tr style="${rowStyle} border-bottom: 1px solid rgba(255,255,255,0.2);">
                        <td style="padding: 15px; font-size: 32px;">${medal}</td>
                        <td style="padding: 15px; font-size: 18px;">
                            <strong>${player.player_name}</strong>
                            ${player.rebuys > 0 ? `<br><span style="opacity: 0.6; font-size: 14px;">è¡¥ç  ${player.rebuys} æ¬¡</span>` : ''}
                        </td>
                        <td style="padding: 15px; text-align: right; font-size: 24px; font-weight: bold;" class="${totalWinClass}">
                            ${player.total_win >= 0 ? '+' : ''}${player.total_win}
                        </td>
                        <td style="padding: 15px; text-align: right; font-size: 20px; color: #FFD700;">
                            ${player.final_chips}
                        </td>
                        <td style="padding: 15px; text-align: right; font-size: 18px;">
                            ${player.win_rate.toFixed(1)}%
                        </td>
                        <td style="padding: 15px; text-align: right; font-size: 16px;">
                            ${player.games_won}/${player.games_played}
                        </td>
                    </tr>
                `;
            });
            
            html += `
                    </tbody>
                </table>
            `;
            
            content.innerHTML = html;
            panel.style.display = 'block';
            
            // éšè—å…¶ä»–æ‰€æœ‰é¢æ¿ (ä½†ä¿æŒä¾§è¾¹æ çš„æ˜¾ç¤º)
            document.getElementById('game-result').style.display = 'none';
            document.getElementById('controls').style.display = 'none';
            // ä¾§è¾¹æ é¢æ¿ä¸éœ€è¦éšè—ï¼Œå¯ä»¥åœ¨æœ€ç»ˆç»“æœæ—¶ç»§ç»­æŸ¥çœ‹
        }

        // é¡µé¢å…³é—­æ—¶æ¸…ç†WebSocketè¿æ¥
        window.addEventListener('beforeunload', () => {
            if (ws) {
                ws.close();
            }
        });
    </script>
</body>
</html>

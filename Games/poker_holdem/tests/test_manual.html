<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>æ’è¡Œæ¦œå’Œæˆ¿ä¸»åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #00ff00;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .player-section {
            border: 2px solid #00ff00;
            padding: 15px;
            margin: 10px 0;
            background: #0a0a0a;
        }
        .owner {
            border-color: gold;
        }
        button {
            background: #00ff00;
            color: black;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-family: monospace;
            font-weight: bold;
        }
        button:hover {
            background: #00cc00;
        }
        .log {
            background: black;
            padding: 10px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
            border: 1px solid #00ff00;
        }
        .log div {
            margin: 2px 0;
        }
        .error {
            color: #ff0000;
        }
        .success {
            color: #00ff00;
        }
        .info {
            color: #ffff00;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® æ’è¡Œæ¦œå’Œæˆ¿ä¸»åŠŸèƒ½æµ‹è¯•</h1>
        
        <!-- Player 1 (Owner) -->
        <div class="player-section owner" id="player1-section">
            <h2>Player 1 - Alice (æˆ¿ä¸»)</h2>
            <div>
                <button onclick="connect(1, 'Alice')">è¿æ¥</button>
                <button onclick="startGame(1)">å¼€å§‹æ¸¸æˆ</button>
                <button onclick="endGame(1)">ç»“æŸæ¸¸æˆ</button>
                <button onclick="getState(1)">è·å–çŠ¶æ€</button>
                <button onclick="gameAction(1, 'check')">Check</button>
                <button onclick="gameAction(1, 'call')">Call</button>
                <button onclick="gameAction(1, 'fold')">Fold</button>
            </div>
            <div class="log" id="log1"></div>
        </div>
        
        <!-- Player 2 -->
        <div class="player-section" id="player2-section">
            <h2>Player 2 - Bob</h2>
            <div>
                <button onclick="connect(2, 'Bob')">è¿æ¥</button>
                <button onclick="startGame(2)">å¼€å§‹æ¸¸æˆ</button>
                <button onclick="endGame(2)">ç»“æŸæ¸¸æˆï¼ˆæµ‹è¯•æƒé™ï¼‰</button>
                <button onclick="getState(2)">è·å–çŠ¶æ€</button>
                <button onclick="gameAction(2, 'check')">Check</button>
                <button onclick="gameAction(2, 'call')">Call</button>
                <button onclick="gameAction(2, 'fold')">Fold</button>
            </div>
            <div class="log" id="log2"></div>
        </div>
        
        <!-- Player 3 -->
        <div class="player-section" id="player3-section">
            <h2>Player 3 - Charlie</h2>
            <div>
                <button onclick="connect(3, 'Charlie')">è¿æ¥</button>
                <button onclick="startGame(3)">å¼€å§‹æ¸¸æˆ</button>
                <button onclick="getState(3)">è·å–çŠ¶æ€</button>
                <button onclick="gameAction(3, 'check')">Check</button>
                <button onclick="gameAction(3, 'call')">Call</button>
                <button onclick="gameAction(3, 'fold')">Fold</button>
            </div>
            <div class="log" id="log3"></div>
        </div>
        
        <div class="player-section">
            <h2>æµ‹è¯•è¯´æ˜</h2>
            <ol style="line-height: 1.8;">
                <li>ä¾æ¬¡ç‚¹å‡»ä¸‰ä¸ªç©å®¶çš„"è¿æ¥"æŒ‰é’®</li>
                <li>ç‚¹å‡»Alice(Player 1)çš„"å¼€å§‹æ¸¸æˆ"</li>
                <li>æ ¹æ®æç¤ºè½®æµä½¿ç”¨Check/Callè¿›è¡Œæ¸¸æˆï¼ˆè§‚å¯Ÿè°æ˜¯å½“å‰ç©å®¶ï¼‰</li>
                <li>æ¸¸æˆç»“æŸåï¼Œç‚¹å‡»"è·å–çŠ¶æ€"æŸ¥çœ‹æ’è¡Œæ¦œæ•°æ®</li>
                <li>æµ‹è¯•Bob (Player 2)çš„"ç»“æŸæ¸¸æˆ"æŒ‰é’®ï¼ˆåº”è¯¥å¤±è´¥ï¼‰</li>
                <li>ç‚¹å‡»Alice (Player 1)çš„"ç»“æŸæ¸¸æˆ"æŒ‰é’®æŸ¥çœ‹æœ€ç»ˆç»“æœ</li>
            </ol>
        </div>
    </div>
    
    <script>
        const players = {
            1: { ws: null, id: null },
            2: { ws: null, id: null },
            3: { ws: null, id: null }
        };
        
        function log(playerNum, message, type = 'info') {
            const logDiv = document.getElementById(`log${playerNum}`);
            const time = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.className = type;
            div.textContent = `[${time}] ${message}`;
            logDiv.appendChild(div);
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function connect(playerNum, name) {
            if (players[playerNum].ws) {
                log(playerNum, 'å·²ç»è¿æ¥!', 'error');
                return;
            }
            
            const ws = new WebSocket(`ws://localhost:8000/ws/${name}`);
            players[playerNum].ws = ws;
            
            ws.onopen = () => {
                log(playerNum, `âœ“ å·²è¿æ¥ä¸º ${name}`, 'success');
            };
            
            ws.onmessage = (event) => {
                const msg = JSON.parse(event.data);
                
                if (msg.type === 'player_id') {
                    players[playerNum].id = msg.data.player_id;
                    log(playerNum, `ID: ${msg.data.player_id.substring(0, 8)}...`, 'success');
                }
                else if (msg.type === 'game_started') {
                    log(playerNum, 'ğŸ® æ¸¸æˆå¼€å§‹!', 'success');
                }
                else if (msg.type === 'game_state') {
                    const data = msg.data;
                    const current = data.current_player_id;
                    const stage = data.game_stage;
                    const isCurrent = current === players[playerNum].id;
                    
                    if (isCurrent) {
                        log(playerNum, `ğŸ‘‰ è½®åˆ°ä½ äº†! (${stage}, min_bet=${data.min_bet})`, 'success');
                    }
                    
                    if (stage === 'showdown') {
                        const result = data.game_result;
                        if (result && result.winners) {
                            log(playerNum, `ğŸ‰ è·èƒœè€…: ${result.winners.map(w => w.name).join(', ')}`, 'success');
                        }
                    }
                }
                else if (msg.type === 'game_ended') {
                    log(playerNum, 'ğŸ æ¸¸æˆå·²ç»“æŸ!', 'success');
                    const rankings = msg.data.rankings;
                    if (rankings) {
                        log(playerNum, `æ€»å…± ${msg.data.total_games} å±€æ¸¸æˆ`, 'info');
                        rankings.forEach(r => {
                            const medal = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'][r.rank - 1] || r.rank;
                            log(playerNum, `${medal} ${r.player_name}: ${r.total_win} (${r.win_rate.toFixed(1)}%)`, 'info');
                        });
                    }
                }
                else {
                    log(playerNum, `ğŸ“© ${msg.type}`, 'info');
                }
            };
            
            ws.onerror = (error) => {
                log(playerNum, `âœ— é”™è¯¯: ${error}`, 'error');
            };
            
            ws.onclose = () => {
                log(playerNum, 'è¿æ¥å·²å…³é—­', 'error');
                players[playerNum].ws = null;
            };
        }
        
        function startGame(playerNum) {
            if (!players[playerNum].ws) {
                log(playerNum, 'è¯·å…ˆè¿æ¥!', 'error');
                return;
            }
            players[playerNum].ws.send(JSON.stringify({ type: 'start_game' }));
            log(playerNum, 'å‘é€: å¼€å§‹æ¸¸æˆ', 'info');
        }
        
        function endGame(playerNum) {
            if (!players[playerNum].ws) {
                log(playerNum, 'è¯·å…ˆè¿æ¥!', 'error');
                return;
            }
            players[playerNum].ws.send(JSON.stringify({ type: 'end_game' }));
            log(playerNum, 'å‘é€: ç»“æŸæ¸¸æˆ', 'info');
        }
        
        function getState(playerNum) {
            if (!players[playerNum].ws) {
                log(playerNum, 'è¯·å…ˆè¿æ¥!', 'error');
                return;
            }
            players[playerNum].ws.send(JSON.stringify({ type: 'get_state' }));
            log(playerNum, 'è¯·æ±‚æ¸¸æˆçŠ¶æ€...', 'info');
            
            // ç­‰å¾…å¹¶æ˜¾ç¤ºç»Ÿè®¡
            setTimeout(() => {
                log(playerNum, '--- æŸ¥çœ‹ä¸Šæ–¹game_stateæ¶ˆæ¯äº†è§£è¯¦æƒ… ---', 'info');
            }, 1000);
        }
        
        function gameAction(playerNum, action) {
            if (!players[playerNum].ws) {
                log(playerNum, 'è¯·å…ˆè¿æ¥!', 'error');
                return;
            }
            players[playerNum].ws.send(JSON.stringify({ 
                type: 'action', 
                action: action 
            }));
            log(playerNum, `å‘é€: ${action}`, 'info');
        }
    </script>
</body>
</html>

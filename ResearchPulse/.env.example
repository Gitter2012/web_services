# =============================================================================
# ResearchPulse Environment Configuration
# =============================================================================
# Copy this file to .env and fill in your values.
#
# This file contains SECRETS and environment-specific overrides.
# Non-sensitive defaults are in:
#   - /config/defaults.yaml (project-level defaults)
#   - /apps/<app>/config/defaults.yaml (app-level defaults)
#
# Configuration precedence (highest to lowest):
#   1. Environment variables (runtime override)
#   2. .env file (this file)
#   3. /config/defaults.yaml (non-sensitive defaults)
#   4. Hardcoded Python defaults in settings.py
# =============================================================================

# ======================
# Application
# ======================
APP_NAME=ResearchPulse
DEBUG=false
APP_HOST=0.0.0.0
APP_PORT=8000
DATA_DIR=./data
URL_PREFIX=/researchpulse
# Comma-separated origins or "*" for all (dev only)
CORS_ORIGINS=*
CORS_ALLOW_CREDENTIALS=false

# ======================
# Database (MySQL)
# ======================
DB_HOST=localhost
DB_PORT=3306
DB_NAME=research_pulse
DB_USER=research_user
DB_PASSWORD=
DB_POOL_SIZE=10
DB_MAX_OVERFLOW=20
DB_POOL_RECYCLE=3600
DB_ECHO=false

# ======================
# Redis Cache (Optional)
# ======================
# Leave REDIS_HOST empty to disable Redis (falls back to in-memory cache)
REDIS_HOST=
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
CACHE_ENABLED=false
CACHE_DEFAULT_TTL=300

# ======================
# JWT Authentication
# ======================
# Leave empty to auto-generate (tokens will invalidate on restart)
JWT_SECRET_KEY=
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=1440
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7

# ======================
# Superuser (First-time Setup)
# ======================
# Created on first startup. Leave password empty to skip creation.
SUPERUSER_USERNAME=admin
SUPERUSER_EMAIL=admin@example.com
SUPERUSER_PASSWORD=

# ======================
# arXiv Crawler
# ======================
# Comma-separated arXiv categories
ARXIV_CATEGORIES=cs.LG,cs.CV,cs.CL
ARXIV_MAX_RESULTS=50
ARXIV_DELAY_BASE=3.0
# Comma-separated: submittedDate, lastUpdatedDate
ARXIV_SORT_MODES=lastUpdatedDate
ARXIV_MARK_PAPER_TYPE=false
# rss or atom
ARXIV_RSS_FORMAT=rss

# ======================
# Weibo Crawler
# ======================
WEIBO_TIMEOUT=30
WEIBO_DELAY_BASE=5.0
WEIBO_DELAY_JITTER=2.0
WEIBO_MAX_RETRY=3
WEIBO_RETRY_BACKOFF=10.0
# Login cookie for authenticated endpoints (copy from browser DevTools)
WEIBO_COOKIE=

# ======================
# Twitter Crawler
# ======================
# API key from https://twitterapi.io
TWITTERAPI_IO_KEY=

# ======================
# Scheduler & Maintenance
# ======================
CRAWL_INTERVAL_HOURS=6
CLEANUP_HOUR=3
BACKUP_HOUR=4
SCHEDULER_TIMEZONE=UTC

# ======================
# Data Retention
# ======================
DATA_RETENTION_DAYS=7
DATA_ARCHIVE_DAYS=30
BACKUP_DIR=./backups
BACKUP_ENABLED=true

# ======================
# Email Configuration
# ======================
EMAIL_ENABLED=false
EMAIL_FROM=
# Backend: smtp, sendgrid, mailgun, brevo
EMAIL_BACKEND=smtp

# ---- SMTP ----
SMTP_HOST=
SMTP_PORT=587
SMTP_USER=
SMTP_PASSWORD=
# Multi-port retry (comma-separated)
SMTP_PORTS=587,465,2525
# SSL direct-connect ports
SMTP_SSL_PORTS=465
SMTP_TIMEOUT=10.0
SMTP_RETRIES=3
SMTP_RETRY_BACKOFF=10.0
SMTP_TLS=true
SMTP_SSL=false

# ---- SendGrid (optional) ----
SENDGRID_API_KEY=

# ---- Mailgun (optional) ----
MAILGUN_API_KEY=
MAILGUN_DOMAIN=

# ---- Brevo (optional) ----
BREVO_API_KEY=

# ---- Notification Settings ----
# Frequency: daily, weekly
EMAIL_NOTIFICATION_FREQUENCY=daily
# Time in HH:MM format
EMAIL_NOTIFICATION_TIME=09:00
EMAIL_MAX_ARTICLES=20
# Email template engine: jinja2 (modern HTML) / legacy (Markdown-based)
EMAIL_TEMPLATE_ENGINE=jinja2

# ======================
# Feature Toggles
# ======================
FEATURE_AI_PROCESSOR=false
FEATURE_EMBEDDING=false
FEATURE_EVENT_CLUSTERING=false
FEATURE_TOPIC_RADAR=false
FEATURE_ACTION_ITEMS=false
FEATURE_REPORT_GENERATION=false

# ======================
# AI Processor (Ollama)
# ======================
# Provider: ollama, openai, claude
AI_PROVIDER=ollama
OLLAMA_BASE_URL=http://localhost:11434
OLLAMA_MODEL=qwen3:32b
# Lightweight model for simple tasks (optional)
OLLAMA_MODEL_LIGHT=
OLLAMA_TIMEOUT=120
# Optional API key for authenticated Ollama deployments
OLLAMA_API_KEY=
AI_CACHE_ENABLED=true
# Cache TTL in seconds (default 24h)
AI_CACHE_TTL=86400
# Max content length for AI processing (chars)
AI_MAX_CONTENT_LENGTH=1500

# ======================
# AI Processor (OpenAI)
# ======================
# API key from https://platform.openai.com
OPENAI_API_KEY=
# Custom base URL for proxies or compatible APIs (e.g. Azure OpenAI, local proxy)
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_MODEL=gpt-4o
OPENAI_MODEL_LIGHT=gpt-4o-mini
OPENAI_TIMEOUT=60

# ======================
# Embedding & Milvus
# ======================
EMBEDDING_PROVIDER=sentence-transformers
EMBEDDING_MODEL=all-MiniLM-L6-v2
EMBEDDING_DIMENSION=384
EMBEDDING_SIMILARITY_THRESHOLD=0.85
EMBEDDING_ENABLED=false
MILVUS_HOST=localhost
MILVUS_PORT=19530
MILVUS_COLLECTION_NAME=article_embeddings

# ======================
# Event Clustering
# ======================
# Rule + semantic weights should sum to 1.0
EVENT_RULE_WEIGHT=0.4
EVENT_SEMANTIC_WEIGHT=0.6
EVENT_MIN_SIMILARITY=0.7

# ======================
# Topic Discovery
# ======================
TOPIC_MIN_FREQUENCY=5
TOPIC_LOOKBACK_DAYS=14

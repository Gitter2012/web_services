<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}管理后台 - ResearchPulse{% endblock %}</title>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    {% include "components/init_script.html" %}
    <script>
        window.ADMIN_BASE = window.AUTH_BASE + '/admin';
    </script>
    <style>
        /* ============================================
           CSS Design Tokens / Variables
           ============================================ */
        :root {
            /* 主色调 */
            --color-primary: #1a1a2e;
            --color-primary-hover: #2d2d4a;
            --color-accent: #4ecdc4;
            --color-accent-light: rgba(78, 205, 196, 0.2);

            /* 背景色 */
            --bg-body: #f0f2f5;
            --bg-card: white;
            --bg-sidebar: #1a1a2e;
            --bg-hover: rgba(255, 255, 255, 0.05);
            --bg-table-hover: #f9fafb;
            --bg-input: white;
            --bg-disabled: #ccc;
            --bg-category: #f9fafb;
            --bg-category-enabled: #ecfdf5;
            --bg-tabs: #f5f5f5;
            --bg-info: #e3f2fd;
            --bg-info-light: #f0f9ff;
            --bg-success-light: #ecfdf5;

            /* 文字色 */
            --text-primary: #1a1a2e;
            --text-secondary: #666;
            --text-muted: #888;
            --text-light: #999;
            --text-inverse: white;
            --text-nav: rgba(255, 255, 255, 0.7);
            --text-table: #333;

            /* 边框色 */
            --border-light: #f0f0f0;
            --border-input: #e0e0e0;
            --border-divider: rgba(255, 255, 255, 0.1);

            /* 状态色 */
            --color-success: #10b981;
            --color-danger: #ef4444;
            --color-warning: #d97706;
            --color-info: #2563eb;

            /* Badge 颜色 */
            --badge-success-bg: #dcfce7;
            --badge-success-text: #059669;
            --badge-danger-bg: #fee2e2;
            --badge-danger-text: #dc2626;
            --badge-info-bg: #dbeafe;
            --badge-info-text: #2563eb;
            --badge-warning-bg: #fef3c7;
            --badge-warning-text: #d97706;

            /* 间距 */
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 12px;
            --spacing-lg: 16px;
            --spacing-xl: 20px;
            --spacing-2xl: 24px;

            /* 圆角 */
            --radius-sm: 4px;
            --radius-md: 6px;
            --radius-lg: 8px;
            --radius-xl: 12px;
            --radius-full: 24px;

            /* 阴影 */
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.08);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.12);
            --shadow-modal: 0 0 0 1px rgba(0, 0, 0, 0.05);

            /* 侧边栏 */
            --sidebar-width: 240px;
            --sidebar-mobile-width: 280px;

            /* 过渡 */
            --transition-fast: 0.2s;
            --transition-normal: 0.3s;

            /* 字体 */
            --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font-family); background: var(--bg-body); min-height: 100vh; }

        .layout { display: grid; grid-template-columns: var(--sidebar-width) 1fr; min-height: 100vh; }

        /* Sidebar */
        .sidebar { background: var(--bg-sidebar); color: var(--text-inverse); padding: 0; }
        .sidebar-header { padding: var(--spacing-xl); border-bottom: 1px solid var(--border-divider); }
        .sidebar-header h2 { font-size: 18px; }
        .sidebar-nav { padding: var(--spacing-md) 0; }

        /* Navigation Groups */
        .nav-group { padding: var(--spacing-sm) 0; }
        .nav-group-title { padding: var(--spacing-sm) var(--spacing-xl) 6px; font-size: 11px; font-weight: 600; color: rgba(255, 255, 255, 0.4); text-transform: uppercase; letter-spacing: 0.5px; }
        .nav-divider { height: 1px; background: rgba(255, 255, 255, 0.1); margin: var(--spacing-sm) var(--spacing-md); }

        .nav-item { display: flex; align-items: center; gap: var(--spacing-md); padding: var(--spacing-md) var(--spacing-xl); color: var(--text-nav); text-decoration: none; font-size: 14px; transition: all var(--transition-fast); }
        .nav-item:hover { background: var(--bg-hover); color: var(--text-inverse); }
        .nav-item.active { background: var(--color-accent-light); color: var(--color-accent); border-right: 3px solid var(--color-accent); }
        .nav-icon { width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .nav-icon svg { width: 18px; height: 18px; stroke-width: 1.5; }
        .nav-item-home { margin-top: var(--spacing-sm); }

        /* Main Content */
        .main { padding: var(--spacing-2xl); overflow-y: auto; }
        .page-header { margin-bottom: var(--spacing-2xl); }
        .page-header h1 { font-size: 24px; color: var(--text-primary); margin-bottom: var(--spacing-sm); }
        .page-header p { color: var(--text-secondary); font-size: 14px; }

        /* Cards */
        .card { background: var(--bg-card); border-radius: var(--radius-xl); box-shadow: var(--shadow-sm); margin-bottom: var(--spacing-2xl); }
        .card-header { padding: var(--spacing-xl) var(--spacing-2xl); border-bottom: 1px solid var(--border-light); display: flex; justify-content: space-between; align-items: center; }
        .card-header h3 { font-size: 16px; color: var(--text-primary); }
        .card-body { padding: var(--spacing-2xl); }

        /* Stats */
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--spacing-lg); margin-bottom: var(--spacing-2xl); }
        .stat-card { background: var(--bg-card); border-radius: var(--radius-xl); padding: var(--spacing-xl); box-shadow: var(--shadow-sm); position: relative; }
        .stat-card.clickable { cursor: pointer; transition: all var(--transition-fast); }
        .stat-card.clickable:hover { box-shadow: var(--shadow-md); transform: translateY(-2px); }
        .stat-card .stat-link { font-size: 12px; color: var(--color-accent); margin-top: var(--spacing-sm); display: none; }
        .stat-card.clickable .stat-link { display: block; }
        .stat-value { font-size: 28px; font-weight: 600; color: var(--text-primary); }
        .stat-label { font-size: 13px; color: var(--text-muted); margin-top: var(--spacing-xs); }

        /* Table */
        .table { width: 100%; border-collapse: collapse; }
        .table th, .table td { padding: var(--spacing-md) var(--spacing-lg); text-align: left; border-bottom: 1px solid var(--border-light); }
        .table th { font-size: 12px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; }
        .table td { font-size: 14px; color: var(--text-table); }
        .table tr:hover { background: var(--bg-table-hover); }

        /* Buttons */
        .btn { padding: var(--spacing-sm) var(--spacing-lg); border-radius: var(--radius-md); font-size: 13px; cursor: pointer; border: none; transition: all var(--transition-fast); }
        .btn-primary { background: var(--color-primary); color: var(--text-inverse); }
        .btn-primary:hover { background: var(--color-primary-hover); }
        .btn-success { background: var(--color-success); color: var(--text-inverse); }
        .btn-danger { background: var(--color-danger); color: var(--text-inverse); }
        .btn-sm { padding: var(--spacing-xs) var(--spacing-md); font-size: 12px; }

        /* Badge */
        .badge { padding: var(--spacing-xs) 10px; border-radius: var(--radius-sm); font-size: 11px; font-weight: 500; }
        .badge-success { background: var(--badge-success-bg); color: var(--badge-success-text); }
        .badge-danger { background: var(--badge-danger-bg); color: var(--badge-danger-text); }
        .badge-info { background: var(--badge-info-bg); color: var(--badge-info-text); }
        .badge-warning { background: var(--badge-warning-bg); color: var(--badge-warning-text); }

        /* Form */
        .form-group { margin-bottom: var(--spacing-lg); }
        .form-label { display: block; font-size: 13px; font-weight: 500; color: var(--text-table); margin-bottom: 6px; }
        .form-input { width: 100%; padding: 10px var(--spacing-md); border: 1px solid var(--border-input); border-radius: var(--radius-md); font-size: 14px; }
        .form-input:focus { outline: none; border-color: var(--color-accent); }
        .form-select { width: 100%; padding: 10px var(--spacing-md); border: 1px solid var(--border-input); border-radius: var(--radius-md); font-size: 14px; background: var(--bg-input); }

        /* Tabs */
        .tabs { display: flex; gap: var(--spacing-xs); background: var(--bg-tabs); padding: var(--spacing-xs); border-radius: var(--radius-lg); margin-bottom: var(--spacing-xl); }
        .tab { padding: var(--spacing-sm) var(--spacing-lg); border: none; background: transparent; border-radius: var(--radius-md); font-size: 13px; cursor: pointer; }
        .tab.active { background: var(--bg-card); box-shadow: var(--shadow-sm); }

        /* Toggle */
        .toggle-item { display: flex; align-items: center; justify-content: space-between; padding: var(--spacing-md) 0; border-bottom: 1px solid var(--border-light); }
        .toggle-item:last-child { border-bottom: none; }
        .toggle-info h4 { font-size: 14px; font-weight: 500; margin-bottom: var(--spacing-xs); }
        .toggle-info p { font-size: 12px; color: var(--text-muted); margin: 0; }
        .toggle-switch { position: relative; width: 44px; height: 24px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .toggle-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--bg-disabled); transition: var(--transition-normal); border-radius: var(--radius-full); }
        .toggle-slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: var(--text-inverse); transition: var(--transition-normal); border-radius: 50%; }
        input:checked + .toggle-slider { background-color: var(--color-accent); }
        input:checked + .toggle-slider:before { transform: translateX(20px); }

        /* Category list */
        .category-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: var(--spacing-sm); max-height: 400px; overflow-y: auto; padding-right: var(--spacing-sm); }
        .category-item { display: flex; align-items: center; justify-content: space-between; padding: 10px var(--spacing-md); background: var(--bg-category); border-radius: var(--radius-md); font-size: 13px; }
        .category-item.enabled { background: var(--bg-category-enabled); }
        .category-item code { font-family: monospace; color: var(--text-secondary); }
        .category-item input[type="checkbox"] { width: 16px; height: 16px; }

        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center; }
        .modal.active { display: flex; }
        .modal-content { background: var(--bg-card); border-radius: var(--radius-xl); width: 500px; max-width: 90%; max-height: 90vh; overflow-y: auto; }
        .modal-header { padding: var(--spacing-xl) var(--spacing-2xl); border-bottom: 1px solid var(--border-light); display: flex; justify-content: space-between; align-items: center; }
        .modal-header h3 { font-size: 18px; }
        .modal-close { font-size: 24px; cursor: pointer; color: var(--text-light); }
        .modal-body { padding: var(--spacing-2xl); }
        .modal-footer { padding: var(--spacing-lg) var(--spacing-2xl); border-top: 1px solid var(--border-light); display: flex; justify-content: flex-end; gap: var(--spacing-sm); }

        .toggle-list { max-height: 500px; overflow-y: auto; }
        .config-panel { animation: fadeIn var(--transition-fast) ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Mobile Header */
        .mobile-header { display: none; background: var(--bg-sidebar); color: var(--text-inverse); padding: var(--spacing-md) var(--spacing-lg); position: sticky; top: 0; z-index: 100; }
        .mobile-header-inner { display: flex; justify-content: space-between; align-items: center; }
        .mobile-header h2 { font-size: 16px; }

        /* Hamburger Menu Button */
        .mobile-menu-btn { display: none; width: 44px; height: 44px; background: transparent; border: none; cursor: pointer; padding: 10px; flex-direction: column; justify-content: center; align-items: center; gap: 5px; }
        .mobile-menu-btn span { display: block; width: 24px; height: 2px; background: var(--text-inverse); transition: all var(--transition-normal); border-radius: 2px; }
        .mobile-menu-btn.active span:nth-child(1) { transform: rotate(45deg) translate(5px, 5px); }
        .mobile-menu-btn.active span:nth-child(2) { opacity: 0; }
        .mobile-menu-btn.active span:nth-child(3) { transform: rotate(-45deg) translate(5px, -5px); }

        /* Mobile Overlay */
        .mobile-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 998; }
        .mobile-overlay.show { display: block; }

        /* Table Footer / Pagination */
        .table-footer { display: flex; justify-content: space-between; align-items: center; padding: var(--spacing-md) var(--spacing-lg); border-top: 1px solid var(--border-light); font-size: 13px; color: var(--text-muted); flex-wrap: wrap; gap: var(--spacing-md); }
        .pagination { display: flex; align-items: center; gap: var(--spacing-xs); }
        .pagination-btn { min-width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border: 1px solid var(--border-input); border-radius: var(--radius-md); background: var(--bg-card); cursor: pointer; transition: all var(--transition-fast); font-size: 13px; }
        .pagination-btn:hover:not(:disabled) { border-color: var(--color-accent); color: var(--color-accent); }
        .pagination-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .pagination-btn.active { background: var(--color-primary); border-color: var(--color-primary); color: var(--text-inverse); }
        .pagination-btn svg { width: 16px; height: 16px; }
        .page-size-select { padding: 6px var(--spacing-sm); border: 1px solid var(--border-input); border-radius: var(--radius-md); font-size: 13px; background: var(--bg-card); cursor: pointer; }

        /* Empty State */
        .empty-state { padding: 48px var(--spacing-2xl); text-align: center; color: var(--text-muted); }
        .empty-state-icon { width: 64px; height: 64px; margin: 0 auto var(--spacing-lg); opacity: 0.5; }
        .empty-state-icon svg { width: 64px; height: 64px; }
        .empty-state-title { font-size: 16px; font-weight: 500; color: var(--text-secondary); margin-bottom: var(--spacing-sm); }
        .empty-state-desc { font-size: 14px; margin-bottom: var(--spacing-lg); }

        /* Skeleton Loading */
        .skeleton { background: linear-gradient(90deg, #f0f0f0 25%, #e8e8e8 50%, #f0f0f0 75%); background-size: 200% 100%; animation: skeleton-loading 1.5s infinite; border-radius: var(--radius-md); }
        @keyframes skeleton-loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

        /* Responsive - Mobile */
        @media (max-width: 768px) {
            .layout { grid-template-columns: 1fr; }
            .mobile-header { display: block; }
            .mobile-menu-btn { display: flex; }
            .sidebar { position: fixed; left: calc(var(--sidebar-mobile-width) * -1); top: 0; width: var(--sidebar-mobile-width); height: 100vh; z-index: 999; transition: left var(--transition-normal) ease; overflow-y: auto; }
            .sidebar.open { left: 0; }
            .main { padding: var(--spacing-lg); }
            .page-header h1 { font-size: 20px; }
            .page-header p { font-size: 13px; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); gap: var(--spacing-md); }
            .stat-card { padding: var(--spacing-lg); }
            .stat-value { font-size: 22px; }
            .card-header { padding: var(--spacing-lg); flex-wrap: wrap; gap: var(--spacing-sm); }
            .card-header h3 { font-size: 14px; }
            .card-body { padding: var(--spacing-lg); overflow-x: auto; }
            .table { min-width: 600px; }
            .tabs { overflow-x: auto; -webkit-overflow-scrolling: touch; }
            .tab { padding: var(--spacing-sm) var(--spacing-md); font-size: 12px; white-space: nowrap; }
            .category-grid { grid-template-columns: 1fr; }
            .form-group { margin-bottom: var(--spacing-md); }
            .form-input, .form-select { padding: var(--spacing-md); font-size: 16px; }
            .btn { padding: 10px 14px; }
            .btn-sm { padding: 6px 10px; font-size: 11px; }
            .modal-content { width: 100%; max-width: 100%; border-radius: 0; max-height: 100vh; }
            .modal-header { padding: var(--spacing-lg); }
            .modal-body { padding: var(--spacing-lg); }
        }
    </style>
    {% block extra_styles %}{% endblock %}
</head>
<body>
    <div class="mobile-header">
        <div class="mobile-header-inner">
            <h2>管理后台</h2>
            <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </div>

    <div class="mobile-overlay" onclick="closeMobileMenu()"></div>

    <div class="layout">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            {% block sidebar %}
            <div class="sidebar-header">
                <h2>管理后台</h2>
            </div>
            <nav class="sidebar-nav" id="sidebar-nav">
                <!-- 概览 -->
                <div class="nav-group">
                    <div class="nav-group-title">概览</div>
                    <a href="#" class="nav-item active" data-section="dashboard">
                        <span class="nav-icon"><i data-lucide="layout-dashboard"></i></span>
                        <span>仪表盘</span>
                    </a>
                </div>

                <!-- 数据管理 -->
                <div class="nav-group">
                    <div class="nav-group-title">数据管理</div>
                    <a href="#" class="nav-item" data-section="sources">
                        <span class="nav-icon"><i data-lucide="database"></i></span>
                        <span>数据源管理</span>
                    </a>
                    <a href="#" class="nav-item" data-section="crawlers">
                        <span class="nav-icon"><i data-lucide="webhook"></i></span>
                        <span>抓取配置</span>
                    </a>
                </div>

                <!-- 内容处理 -->
                <div class="nav-group">
                    <div class="nav-group-title">内容处理</div>
                    <a href="#" class="nav-item" data-section="ai">
                        <span class="nav-icon"><i data-lucide="bot"></i></span>
                        <span>AI 配置</span>
                    </a>
                    <a href="#" class="nav-item" data-section="embedding">
                        <span class="nav-icon"><i data-lucide="brain"></i></span>
                        <span>向量嵌入</span>
                    </a>
                    <a href="#" class="nav-item" data-section="events">
                        <span class="nav-icon"><i data-lucide="newspaper"></i></span>
                        <span>事件管理</span>
                    </a>
                    <a href="#" class="nav-item" data-section="topics">
                        <span class="nav-icon"><i data-lucide="tags"></i></span>
                        <span>主题管理</span>
                    </a>
                </div>

                <!-- 用户与权限 -->
                <div class="nav-group">
                    <div class="nav-group-title">用户与权限</div>
                    <a href="#" class="nav-item" data-section="users">
                        <span class="nav-icon"><i data-lucide="users"></i></span>
                        <span>用户管理</span>
                    </a>
                    <a href="#" class="nav-item" data-section="roles">
                        <span class="nav-icon"><i data-lucide="shield"></i></span>
                        <span>角色管理</span>
                    </a>
                    <a href="#" class="nav-item" data-section="audit">
                        <span class="nav-icon"><i data-lucide="clipboard-list"></i></span>
                        <span>审计日志</span>
                    </a>
                </div>

                <!-- 系统运维 -->
                <div class="nav-group">
                    <div class="nav-group-title">系统运维</div>
                    <a href="#" class="nav-item" data-section="email">
                        <span class="nav-icon"><i data-lucide="mail"></i></span>
                        <span>邮件推送</span>
                    </a>
                    <a href="#" class="nav-item" data-section="reports">
                        <span class="nav-icon"><i data-lucide="file-text"></i></span>
                        <span>报告管理</span>
                    </a>
                    <a href="#" class="nav-item" data-section="backups">
                        <span class="nav-icon"><i data-lucide="hard-drive"></i></span>
                        <span>备份管理</span>
                    </a>
                    <a href="#" class="nav-item" data-section="config">
                        <span class="nav-icon"><i data-lucide="settings"></i></span>
                        <span>系统配置</span>
                    </a>
                    <a href="#" class="nav-item" data-section="pipeline">
                        <span class="nav-icon"><i data-lucide="git-branch"></i></span>
                        <span>Pipeline 监控</span>
                    </a>
                </div>

                <!-- 返回首页 -->
                <div class="nav-divider"></div>
                <a href="#" class="nav-item nav-item-home" onclick="location.href=APP_BASE+'/'; return false;">
                    <span class="nav-icon"><i data-lucide="home"></i></span>
                    <span>返回首页</span>
                </a>
            </nav>
            {% endblock %}
        </nav>

        <!-- Main Content -->
        <main class="main">
            {% block content %}{% endblock %}
        </main>
    </div>

    <script>
        // Mobile Menu Functions
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.mobile-overlay');
            const btn = document.querySelector('.mobile-menu-btn');
            sidebar.classList.toggle('open');
            overlay.classList.toggle('show');
            btn.classList.toggle('active');
        }

        function closeMobileMenu() {
            document.getElementById('sidebar').classList.remove('open');
            document.querySelector('.mobile-overlay').classList.remove('show');
            document.querySelector('.mobile-menu-btn').classList.remove('active');
        }

        // Section Navigation (to be overridden by pages)
        function showSection(section) {
            closeMobileMenu();
            // Override in page-specific scripts
        }

        // Initialize Lucide icons
        lucide.createIcons();
    </script>
    {% block scripts %}{% endblock %}
</body>
</html>

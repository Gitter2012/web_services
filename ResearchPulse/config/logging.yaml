# ===========================================
# ResearchPulse Logging Configuration
# ===========================================
# Python logging.config.dictConfig format
# See: https://docs.python.org/3/library/logging.config.html

# ===========================================
# Version (required for dictConfig)
# ===========================================
version: 1

# ===========================================
# Don't disable existing loggers
# ===========================================
disable_existing_loggers: false

# ===========================================
# Formatters
# ===========================================
formatters:
  # Standard format for console output
  standard:
    format: "%(asctime)s | %(levelname)-8s | %(name)s | %(message)s"
    datefmt: "%Y-%m-%d %H:%M:%S"

  # Detailed format for file output
  detailed:
    format: "%(asctime)s | %(levelname)-8s | %(name)s:%(lineno)d | %(funcName)s | %(message)s"
    datefmt: "%Y-%m-%d %H:%M:%S"

  # Simple format for error logs
  error:
    format: "%(asctime)s | %(levelname)-8s | %(name)s | %(message)s | %(exc_info)s"
    datefmt: "%Y-%m-%d %H:%M:%S"

# ===========================================
# Handlers
# ===========================================
handlers:
  # Console handler (stdout)
  console:
    class: logging.StreamHandler
    level: INFO
    formatter: standard
    stream: ext://sys.stdout

  # File handler for all logs (rotating)
  file:
    class: logging.handlers.RotatingFileHandler
    level: DEBUG
    formatter: detailed
    filename: logs/researchpulse.log
    maxBytes: 10485760  # 10 MB
    backupCount: 5
    encoding: utf-8

  # Separate file for errors only
  error_file:
    class: logging.handlers.RotatingFileHandler
    level: ERROR
    formatter: error
    filename: logs/error.log
    maxBytes: 10485760  # 10 MB
    backupCount: 5
    encoding: utf-8

  # File for scheduler/crawler operations
  scheduler_file:
    class: logging.handlers.RotatingFileHandler
    level: DEBUG
    formatter: detailed
    filename: logs/scheduler.log
    maxBytes: 10485760  # 10 MB
    backupCount: 3
    encoding: utf-8

# ===========================================
# Loggers (module-specific configuration)
# ===========================================
loggers:
  # Application modules
  apps:
    level: DEBUG
    handlers: [console, file]
    propagate: false

  # Scheduler module
  apps.scheduler:
    level: DEBUG
    handlers: [console, scheduler_file]
    propagate: false

  # Crawler module
  apps.crawler:
    level: DEBUG
    handlers: [console, file]
    propagate: false

  # AI processing
  apps.ai_processor:
    level: DEBUG
    handlers: [console, file]
    propagate: false

  # Common utilities
  common:
    level: DEBUG
    handlers: [console, file]
    propagate: false

  # Core modules (auth, db, security)
  core:
    level: INFO
    handlers: [console, file]
    propagate: false

  # Third-party libraries (reduce verbosity)
  httpx:
    level: WARNING
    handlers: [console]
    propagate: false

  httpcore:
    level: WARNING
    handlers: [console]
    propagate: false

  urllib3:
    level: WARNING
    handlers: [console]
    propagate: false

  sqlalchemy:
    level: WARNING
    handlers: [console, file]
    propagate: false

  sqlalchemy.engine:
    level: WARNING
    handlers: [console, file]
    propagate: false

  apscheduler:
    level: INFO
    handlers: [console, scheduler_file]
    propagate: false

  uvicorn:
    level: INFO
    handlers: [console]
    propagate: false

  uvicorn.access:
    level: WARNING
    handlers: [console]
    propagate: false

  feedparser:
    level: WARNING
    handlers: [console]
    propagate: false

  milvus:
    level: WARNING
    handlers: [console]
    propagate: false

# ===========================================
# Root Logger
# ===========================================
root:
  level: INFO
  handlers: [console, file, error_file]
